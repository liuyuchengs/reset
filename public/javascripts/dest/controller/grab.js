define(function(){return function($scope,$rootScope,$window,$location,Tool,Ajax,Weixin){$scope.queryParams={dayDate:"",professionId:2,city:"深圳",currentPage:1,area:""},$scope.grabs=[],$scope.hasBg=!1,$scope.noGrab=!1,$scope.noProductText="",$scope.loading=!1,$scope.hasDate=!1,$scope.hasArea=!1,$scope.hasClass=!1,$scope.hasBg=!1,$scope.showTip=!1,$scope.shareObj={title:"悠康医生是信息就医平台。",desc:"用悠康，有健康。悠康医生为您提供各类优惠医疗项目，快来看看吧!",link:"https://www.uokang.com/v2/htmls/index.html#/home",imgUrl:"https://www.uokang.com/new/contents/img/logo.png",success:function(){Tool.setLocal("share","true"),$scope.switchTip("close")},cancel:function(){}},$scope.menuParams={area:!1,classes:!1,date:!1},$scope.areaParams={"default":{has:!0,val:""},futian:{has:!1,val:"福田区"},nanshan:{has:!1,val:"南山区"},luohu:{has:!1,val:"罗湖区"},baoan:{has:!1,val:"宝安区"},longhua:{has:!1,val:"龙华新区"},longgang:{has:!1,val:"龙岗区"},yantian:{has:!1,val:"盐田区"}},$scope.dateParams={},$scope.classParams={jieya:{has:!0,id:2},meirong:{has:!1,id:3},tuina:{has:!1,id:6}},window.onscroll=function(){if(!$scope.loading&&!$scope.noGrab){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.init=function(){$rootScope.hasBgColor=!1,$scope.getQueryParams(),$scope.loadDate($scope.loadData),Weixin.wxInit($scope),Weixin.wxConfig($scope)},$scope.getQueryParams=function(){$location.search().item&&"meirong"==$location.search().item&&($scope.queryParams.professionId=3)},$scope.loadDate=function(callback){Ajax.get({url:Tool.host+"/wx/gift/querydate"}).then(function(data){for(var i in data){var item=data[i];0==i?($scope.dateParams[item.value]={has:!0,val:item.value},$scope.queryParams.dayDate=item.value):$scope.dateParams[item.value]={has:!1,val:item.value}}callback()})["catch"](function(){Tool.alert("时间加载异常，请稍后再试！")})["finally"](function(){$rootScope.loading=!1})},$scope.switchMenu=function(menu){switch(menu){case"area":$scope.hasDate&&($scope.hasDate=!1,$scope.menuParams.date=!1),$scope.hasClass&&($scope.hasClass=!1,$scope.menuParams.classes=!1),$scope.hasArea=!$scope.hasArea,$scope.noGrab=!1,$scope.hasArea?$scope.menuParams.area=!0:$scope.menuParams.area=!1;break;case"date":$scope.hasArea&&($scope.hasArea=!1,$scope.menuParams.area=!1),$scope.hasClass&&($scope.hasClass=!1,$scope.menuParams.classes=!1),$scope.hasDate=!$scope.hasDate,$scope.noGrab=!1,$scope.hasDate?$scope.menuParams.date=!0:$scope.menuParams.date=!1;break;case"class":$scope.hasDate&&($scope.hasDate=!1,$scope.menuParams.date=!1),$scope.hasArea&&($scope.hasArea=!1,$scope.menuParams.area=!1),$scope.hasClass=!$scope.hasClass,$scope.noGrab=!1,$scope.hasClass?$scope.menuParams.classes=!0:$scope.menuParams.classes=!1}$scope.hasDate||$scope.hasArea||$scope.hasClass?$scope.hasBg=!0:$scope.hasBg=!1},$scope.dateSelect=function(params){Tool.select(params,$scope.dateParams),$scope.queryParams.dayDate=params,$scope.queryParams.currentPage=1,$scope.grabs=[],$scope.loadData(),$scope.switchMenu("date")},$scope.areaSelect=function(params){Tool.select(params,$scope.areaParams),$scope.queryParams.area=$scope.areaParams[params].val,$scope.queryParams.currentPage=1,$scope.grabs=[],$scope.loadData(),$scope.switchMenu("area")},$scope.classSelect=function(params){Tool.select(params,$scope.classParams),$scope.queryParams.professionId=$scope.classParams[params].id,$scope.queryParams.currentPage=1,$scope.grabs=[],$scope.loadData(),$scope.switchMenu("class")},$scope.loadData=function(){Ajax.post({url:Tool.host+"/wx/gift/queryproduct",params:$scope.queryParams}).then(function(data){data.length<1?($scope.grabs.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noGrab=!0):($scope.merge(data),$scope.grabs=$scope.grabs.concat(data))})["catch"](function(){Tool.alert("数据加载失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.loadData()},$scope.merge=function(items){items.forEach(function(item){0==item.amount|null==item.amount?(item.noamount=!0,item.btnMess="抢光了"):(item.noamount=!1,item.btnMess="立即抢")})},$scope.writeCode=function(noamount,productId,hospitalId){noamount||(Tool.checkLogin()?Tool.isUserInfoComplete()?(Tool.loadUserinfo(),null==Tool.userInfo.giftCode||0==Tool.userInfo.giftCode?Tool.alert("一个用户只能享受一次免费项目，您已经抢过了!"):Tool.getLocal("share")?Tool.changeRoute("/grab/code","productId="+productId+"&hospitalId="+hospitalId+"&dayDate="+$scope.queryParams.dayDate):(Weixin.wxShare($scope.shareObj),$scope.switchTip("open"))):Tool.comfirm("请完善个人信息!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/user")}):Tool.comfirm("请先登录并完善个人信息!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/login")}))},$scope.question=function(){Tool.alert("每个用户只可享受一次免费抢单，如需帮助请致电：0755-26905699")},$scope.switchTip=function(params){"close"===params&&($scope.showTip=!1),"open"===params&&($scope.showTip=!0)}}});