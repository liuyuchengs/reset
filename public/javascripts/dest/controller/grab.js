define(["require","exports"],function(require,exports){"use strict";function grab($scope,$rootScope,$window,$location,ToolService,AjaxService,WeixinService){$scope.queryParams={dayDate:"",professionId:2,city:"深圳",currentPage:1,area:""},$scope.grabs=[],$scope.showTip=!1;var shareObj={title:"悠康医生是信息就医平台。",desc:"用悠康，有健康。悠康医生为您提供各类优惠医疗项目，快来看看吧!",link:"https://www.uokang.com/mobile/htmls/index.html#/home",imgUrl:"https://www.uokang.com/new/contents/img/logo.png",success:function(){ToolService.setLocal("share","true"),$scope.switchTip("close")},cancel:function(){}};$scope.areaParams=ToolService.areaParams,$scope.dataParams=[],$scope.classParams=[{has:!0,val:"洁牙",id:2},{has:!1,val:"美容",id:3},{has:!1,val:"推拿",id:6}],$scope.menuParams=[{has:!1,val:"区域",children:$scope.areaParams},{has:!1,val:"分类",children:$scope.classParams},{has:!1,val:"日期",children:$scope.dataParams}];var getQueryParams=function(){$location.search().item&&"meirong"==$location.search().item&&($scope.queryParams.professionId=3)},loadDate=function(callback){AjaxService.get({url:ToolService.host+"/wx/gift/querydate"}).then(function(data){for(var i=0;i<data.length;i++){var item=data[i];0==i?($scope.dataParams.push({has:!0,val:item.value,id:item.value}),$scope.queryParams.dayDate=item.value):$scope.dataParams.push({has:!1,val:item.value,id:item.value})}callback&&callback()})};$scope.switchMenu=function(index,obj){ToolService.select(index,obj,!0),$rootScope.globalProp.hasBlackBg=obj[index].has},$scope.switchDrop=function(index,obj){ToolService.select(index,obj),obj===$scope.areaParams&&($scope.queryParams.area=obj[index].id,$scope.menuParams[0].has=!1),obj===$scope.classParams&&($scope.queryParams.professionId=obj[index].id,$scope.menuParams[1].has=!1),obj===$scope.dataParams&&($scope.queryParams.dayDate=obj[index].val,$scope.menuParams[2].has=!1),$scope.grabs=[],$rootScope.followTip.has=!1,loadData(),$rootScope.globalProp.hasBlackBg=!1};var loadData=function(){AjaxService.post({url:ToolService.host+"/wx/gift/queryproduct",data:$scope.queryParams}).then(function(data){data.length<1?($scope.grabs.length<1?$rootScope.followTip.val=$rootScope.followTip.empty:$rootScope.followTip.val=$rootScope.followTip.no,$rootScope.followTip.has=!0):(merge(data),$scope.grabs=$scope.grabs.concat(data))})},merge=function(items){items.forEach(function(item){0==item.amount||null==item.amount?(item.noamount=!0,item.btnMess="抢光了"):(item.noamount=!1,item.btnMess="立即抢")})};$scope.writeCode=function(noamount,productId,hospitalId){noamount||(ToolService.checkLogin()?ToolService.infoComplete()?(ToolService.loadUser(),null==ToolService.user.giftCode||0==ToolService.user.giftCode?ToolService.alert("一个用户只能享受一次免费项目，您已经抢过了!"):ToolService.getLocal("share")?ToolService.changeRoute("/grab/code","productId="+productId+"&hospitalId="+hospitalId+"&dayDate="+$scope.queryParams.dayDate):(WeixinService.wxShare(shareObj),$scope.switchTip("open"))):ToolService.comfirm("请完善个人信息!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/user")}):ToolService.comfirm("请先登录并完善个人信息!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/login")}))},$scope.question=function(){ToolService.alert("每个用户只可享受一次免费抢单，如需帮助请致电：0755-26905699")},$scope.switchTip=function(params){"close"===params&&($scope.showTip=!1),"open"===params&&($scope.showTip=!0)},ToolService.reset(),getQueryParams(),loadDate(loadData),WeixinService.wxInit(),WeixinService.wxConfig(),ToolService.onWindowListen(function(){$scope.queryParams.currentPage++,loadData()})}return grab});