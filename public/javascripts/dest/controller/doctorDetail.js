define(["require","exports","Swiper"],function(require,exports,Swiper){"use strict";function doctorDetail($scope,$rootScope,$location,$anchorScroll,AjaxService,ToolService){$scope.hasTime=!1,$scope.hasProduct=!1,$scope.description={has:!1,val:"查看全部"},$scope.use={has:!1,val:"查看全部"},$scope.follow={hasFollow:!1,followText:"关注"},$scope.id=null,$scope.doctorInfo={},$scope.assessInfo=[],$scope.time={hasSelect:!1,openSelect:!1,selectIndex:null,selectObj:null,selectId:null,noTime:!1,timeList:[]},$scope.order={hospitalId:"",doctorId:"",productId:"",scheduleId:"",doctorName:"",treatmentTime:"",hospitalName:"",hospitalAddress:"",preferPrice:"",productName:"",flag:1,dealMoney:"",payMoney:"",realMoney:"",giftMoney:"",code:null,discountid:null},$scope.queryParams={id:null,currentPage:1,pageRows:10};var initSwiper=function(){$scope.mySwiper=new Swiper(".swiper-container",{slidesPerView:4,slidesPerGroup:4,observeParents:!0,observer:!0})};$scope.toPage=function(params,$event){"per"===params&&$scope.mySwiper.slidePrev(),"next"===params&&$scope.mySwiper.slideNext(),$event.stopPropagation()},$scope.selectTime=function(){$scope.hasTime=!$scope.hasTime},$scope.selectProduct=function(){$scope.hasProduct=!$scope.hasProduct};var getParams=function(){$location.search().id?($scope.id=$location.search().id,$scope.queryParams.id=$scope.id):ToolService.changeRoute("/doctor")};$scope.showDescription=function(){$scope.description.has=!$scope.description.has,$scope.description.has?$scope.description.val="收起简介":$scope.description.val="查看全部"},$scope.showUse=function(){$scope.use.has=!$scope.use.has,$scope.use.has?$scope.use.val="收起简介":$scope.use.val="查看全部"};var queryDoctor=function(){var params={needPackageInfo:!0,id:$scope.id,accessToken:""};ToolService.checkLogin()?(ToolService.loadUser(),params.accessToken=ToolService.user.accessToken):params.accessToken=null,AjaxService.post({url:ToolService.host+"/wx/doctor/queryDoctorDetailInfo",data:params}).then(function(data){0==data.code&&($scope.order.doctorName=data.data.doctorName,$scope.order.doctorId=data.data.id,$scope.order.hospitalId=data.data.hospitalId,$scope.order.hospitalName=data.data.hospitalname,$scope.order.hospitalAddress=data.data.hospitaladdress,mergeDoctor(data.data),$scope.doctorInfo=data.data)})},mergeDoctor=function(ele){ToolService.empty(ele.score)?ele.score="暂无评分":ele.score+="分",1==ele.focusState&&($scope.follow.hasFollow=!0,$scope.follow.followText="已关注"),ele.dentallist.forEach(function(item){ToolService.empty(item.priceunit)?item.preferPriceType=item.pricetype:item.preferPriceType=item.pricetype+"/"+item.priceunit})},querySchedule=function(){AjaxService.post({url:ToolService.host+"/wx/order/querybydoctorid",data:{doctorId:$scope.id}}).then(function(data){0==data.code&&(data.data.length>0?mergeSchedule(data.data):$scope.time.noTime=!0)})},mergeSchedule=function(items){var initBoolean=!0;items.forEach(function(item){var childrenList=[];item.timeList.length>0&&item.timeList.forEach(function(childrenItem){childrenList.push({has:!1,id:childrenItem.scheduleid,val:childrenItem.starttime})}),$scope.time.timeList.push({has:initBoolean,val:item.date.slice(5,10),id:item.scheduleid,children:childrenList}),initBoolean=!1})},queryAssess=function(){AjaxService.post({url:ToolService.host+"/wx/review/showdoctorreview",data:$scope.queryParams}).then(function(data){0==data.code&&(data.data.forEach(function(item){null==item.totalscore?item.totalscore="暂无评分":item.totalscore=item.totalscore+"分"}),$scope.assessInfo=data.data)})};$scope.switchDay=function(index,$event){ToolService.select(index,$scope.time.timeList),$event.stopPropagation()},$scope.selectTime=function(index,obj,$event){$event.stopPropagation(),null==$scope.time.selectIndex?($scope.time.selectIndex=index,$scope.time.selectObj=obj,ToolService.select(index,obj.children)):(ToolService.select($scope.time.selectIndex,$scope.time.selectObj.children,!0),$scope.time.selectIndex=index,$scope.time.selectObj=obj,ToolService.select(index,obj.children)),$scope.time.hasSelect=!0,$scope.order.scheduleId=obj.children[index].id,$scope.order.treatmentTime=obj.val+" "+obj.children[index].val,$scope.time.openSelect=!1},$scope.orderDetail=function(id,title,price){$scope.time.noTime?ToolService.alert("此医生没有排班，暂不能下单。去其他医生看看吧!"):$scope.time.hasSelect?ToolService.checkLogin()?ToolService.infoComplete()?($scope.order.productId=id,$scope.order.productName=title,$scope.order.preferPrice="￥"+price,ToolService.loadUser(),AjaxService.post({url:ToolService.host+"/wx/order/checkCodeMoney",data:{productId:$scope.order.productId},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){$scope.order.dealMoney=data.dealMoney,$scope.order.payMoney=data.payMoney,$scope.order.realMoney=data.realMoney,$scope.order.giftMoney=data.giftMoney,parseFloat($scope.order.giftMoney)<=0&&($scope.order.flag=null),ToolService.setSession("makeorder",$scope.order),ToolService.changeRoute("/makeorder")})):ToolService.comfirm("请完善个人信息!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/user/userInfo")}):ToolService.comfirm("请先登录并完善个人信息",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/login")}):ToolService.alert("请先预约就医时间!")},$scope.openSelect=function(){$scope.time.noTime?ToolService.alert("此医生没有排班，暂不能下单。去其他医生看看吧!"):$scope.time.openSelect=!0},$scope.hideSelect=function(){$scope.time.openSelect=!1},$scope.ask=function(){ToolService.checkLogin()?(ToolService.loadUser(),ToolService.changeRoute("/doctor/askDoctor","id="+$scope.id)):ToolService.comfirm("请先登录",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/login")})},$scope.goAssess=function(){$anchorScroll("doctorAssess")},$scope.switchFollow=function(){ToolService.checkLogin()?(ToolService.loadUser(),$scope.follow.hasFollow?cacelFollow():tofollow()):ToolService.comfirm("请先登录!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/login")})};var tofollow=function(){AjaxService.post({url:ToolService.host+"/wx/post/focus",data:{flag:2,userId:$scope.id},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code?($scope.follow.hasFollow=!0,$scope.follow.followText="已关注"):ToolService.alert("关注失败，稍后再试!")})},cacelFollow=function(){AjaxService.post({url:ToolService.host+"/wx/post/cacelFocus",data:{flag:2,userId:$scope.id},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code?($scope.follow.hasFollow=!1,$scope.follow.followText="关注"):ToolService.alert("取消关注失败，稍后再试!")})};$scope.back=function(){window.history.back()},ToolService.reset(),$rootScope.globalProp.hasBgColor=!0,getParams(),queryDoctor(),querySchedule(),initSwiper(),queryAssess()}return doctorDetail});