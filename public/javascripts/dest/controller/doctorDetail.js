define(function(){return function($scope,$rootScope,$location,$anchorScroll,Ajax,Tool){$scope.loading=!1,$scope.hasTime=!1,$scope.hasProduct=!1,$scope.description={has:!1,val:"查看全部"},$scope.use={has:!1,val:"查看全部"},$scope.follow={hasFollow:!1,followText:"关注"},$scope.id=null,$scope.doctorInfo={},$scope.assessInfo=[],$scope.time={hasSelect:!1,openSelect:!1,selectDay:null,selectTime:null,selectId:null,noTime:!1,timeList:{}},$scope.order={hospitalId:"",doctorId:"",productId:"",scheduleId:"",doctorName:"",treatmentTime:"",hospitalName:"",hospitalAddress:"",preferPrice:"",productName:"",flag:1,dealMoney:"",payMoney:"",realMoney:"",giftMoney:"",code:null,discountid:null},$scope.queryParams={id:null,currentPage:1,pageRows:10},$scope.init=function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),$scope.getParams(),$scope.queryDoctor(),$scope.querySchedule(),$scope.initSwiper(),$scope.queryAssess()},$scope.initSwiper=function(){$scope.mySwiper=new Swiper(".swiper-container",{slidesPerView:4,slidesPerGroup:4,observeParents:!0,observer:!0})},$scope.toPage=function(params,$event){"per"===params&&$scope.mySwiper.slidePrev(),"next"===params&&$scope.mySwiper.slideNext(),$event.stopPropagation()},$scope.selectTime=function(){$scope.hasTime=!$scope.hasTime},$scope.selectProduct=function(){$scope.hasProduct=!$scope.hasProduct},$scope.getParams=function(){$location.search().id?($scope.id=$location.search().id,$scope.queryParams.id=$scope.id):Tool.changeRoute("/doctor")},$scope.showDescription=function(){$scope.description.has=!$scope.description.has,$scope.description.has?$scope.description.val="收起简介":$scope.description.val="查看全部"},$scope.showUse=function(){$scope.use.has=!$scope.use.has,$scope.use.has?$scope.use.val="收起简介":$scope.use.val="查看全部"},$scope.queryDoctor=function(){var params={needPackageInfo:!0,id:$scope.id};Tool.checkLogin()&&(Tool.loadUserinfo(),params.accessToken=Tool.userInfo.accessToken),Ajax.post({url:Tool.host+"/wx/doctor/queryDoctorDetailInfo",params:params}).then(function(data){0==data.code?($scope.order.doctorName=data.data.doctorName,$scope.order.doctorId=data.data.id,$scope.order.hospitalId=data.data.hospitalId,$scope.order.hospitalName=data.data.hospitalname,$scope.order.hospitalAddress=data.data.hospitaladdress,1==data.data.focusState&&($scope.follow.hasFollow=!0,$scope.follow.followText="已关注"),data.data.dentallist.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype}),$scope.doctorInfo=data.data):Tool.alert("连接数据失败，请稍后再试!")})["catch"](function(){Tool.alert("连接数据失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeDoctor=function(items){items.forEach(function(item){null==item.score|""==item.score?item.score="暂无评分":item.score+="分"})},$scope.querySchedule=function(){Ajax.post({url:Tool.host+"/wx/order/querybydoctorid",params:{doctorId:$scope.id}}).then(function(data){0==data.code?data.data.length>0?$scope.mergeSchedule(data.data):$scope.time.noTime=!0:Tool.alert("数据连接失败，请稍后再试!")})["catch"](function(){Tool.alert("数据连接失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeSchedule=function(items){var first=!0;items.forEach(function(item){var property=item.date.slice(5,10);item.date=property,first?($scope.time.timeList[property]={has:!0,value:item},first=!1):$scope.time.timeList[property]={has:!1,value:item}})},$scope.queryAssess=function(){Ajax.post({url:Tool.host+"/wx/review/showdoctorreview",params:$scope.queryParams}).then(function(data){0==data.code&&(data.data.forEach(function(item){null==item.totalscore?item.totalscore="暂无评分":item.totalscore=item.totalscore+"分"}),$scope.assessInfo=data.data)})["catch"](function(){Tool.alert("数据连接失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.switchDay=function(property){Tool.select(property,$scope.time.timeList)},$scope.selectTime=function(id,time,day){if(null!=$scope.time.selectDay&&null!=$scope.time.selectId){var selectDay=$scope.time.selectDay,selectId=$scope.time.selectId;if($scope.time.timeList[selectDay]){var days=$scope.time.timeList[selectDay].value;for(var index in days.timeList)days.timeList[index].scheduleid==selectId&&(days.timeList[index].has=!1)}}if($scope.time.timeList[day]){var days=$scope.time.timeList[day].value;for(var index in days.timeList)if(days.timeList[index].scheduleid==id)return days.timeList[index].has=!0,$scope.time.selectDay=day,$scope.time.selectId=id,$scope.time.selectTime=time,$scope.time.hasSelect=!0,$scope.order.scheduleId=id,$scope.order.treatmentTime=day+" "+time,void($scope.time.openSelect=!1)}},$scope.orderDetail=function(id,title,price){$scope.time.noTime?Tool.alert("此医生没有排班，暂不能下单。去其他医生看看吧!"):$scope.time.hasSelect?Tool.checkLogin()?Tool.isUserInfoComplete()?($scope.order.productId=id,$scope.order.productName=title,$scope.order.preferPrice="￥"+price,Tool.loadUserinfo(),Ajax.post({url:Tool.host+"/wx/order/checkCodeMoney",params:{productId:$scope.order.productId},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){$scope.order.dealMoney=data.dealMoney,$scope.order.payMoney=data.payMoney,$scope.order.realMoney=data.realMoney,$scope.order.giftMoney=data.giftMoney,parseFloat($scope.order.giftMoney)<=0&&($scope.order.flag=null),Tool.setSession("makeorder",$scope.order),Tool.changeRoute("/makeorder")})["catch"](function(){Tool.alert("加载App付款金额失败!")})["finally"](function(){$rootScope.loading=!1})):Tool.comfirm("请完善个人信息!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/user/userInfo")}):Tool.comfirm("请先登录并完善个人信息",function(){$rootScope.hasTip=!1,Tool.changeRoute("/login")}):Tool.alert("请先预约就医时间!")},$scope.openSelect=function(){$scope.time.noTime?Tool.alert("此医生没有排班，暂不能下单。去其他医生看看吧!"):$scope.time.openSelect=!0},$scope.hideSelect=function($event){$scope.time.openSelect=!1},$scope.ask=function(){Tool.checkLogin()?(Tool.loadUserinfo(),Tool.changeRoute("/doctor/askDoctor","id="+$scope.id)):Tool.comfirm("请先登录",function(){$rootScope.hasTip=!1,Tool.changeRoute("/login")})},$scope.goAssess=function(){$anchorScroll("doctorAssess")},$scope.switchFollow=function(){Tool.checkLogin()?(Tool.loadUserinfo(),$scope.follow.hasFollow?$scope.cacelFollow():$scope.tofollow()):Tool.comfirm("请先登录!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/login")})},$scope.tofollow=function(){Ajax.post({url:Tool.host+"/wx/post/focus",params:{flag:2,userId:$scope.id},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?($scope.follow.hasFollow=!0,$scope.follow.followText="已关注"):Tool.alert("关注失败，稍后再试!")})["catch"](function(){Tool.alert("连接数据失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.cacelFollow=function(){Ajax.post({url:Tool.host+"/wx/post/cacelFocus",params:{flag:2,userId:$scope.id},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?($scope.follow.hasFollow=!1,$scope.follow.followText="关注"):Tool.alert("取消关注失败，稍后再试!")})["catch"](function(){Tool.alert("连接数据失败，稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.back=function(){window.history.back()}}});