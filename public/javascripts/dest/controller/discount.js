define(function(){return function($scope,$rootScope,Tool,Ajax){$scope.itemState="discount",$scope.discountSelect=!0,$scope.currentPage=1,$scope.productInfo=[],$scope.noProduct=!1,$scope.noProductText="",$scope.loading=!1,$scope.init=function(){$rootScope.hasBgColor=!1,$scope.loadGift()},$scope.loadGift=function(){if("discount"==$scope.itemState)var url=Tool.host+"/wx/order/queryByGift";else var url=Tool.host+"/wx/order/queryGift";Ajax.post({url:url,params:{currentPage:$scope.currentPage},headers:{accessToken:""}}).then(function(data){0==data.code?data.data.length<1?($scope.productInfo.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeProdcut(data.data),$scope.productInfo=$scope.productInfo.concat(data.data)):Tool.alert(data.message)})["catch"](function(){$scope.noProduct=!0,Tool.alert("获取项目信息失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype,item.money&&(item.preferPrice=item.money)})},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.loadNext=function(){$scope.currentPage++,$scope.loadGift()},$scope.switchState=function(item){"discount"==item?$scope.itemState!=item&&($scope.currentPage=1,$scope.discountSelect=!0,$scope.noProduct=!1,$scope.itemState=item,$scope.productInfo=[],$scope.loadGift()):$scope.itemState!=item&&($scope.currentPage=1,$scope.discountSelect=!1,$scope.noProduct=!1,$scope.itemState=item,$scope.productInfo=[],$scope.loadGift())},$scope.detail=function(proId,hospitalId,preferPrice){var query="productId="+proId+"&hospitalId="+hospitalId;"discount"==$scope.itemState?query+="&code=123":"month"==$scope.itemState&&(query+="&discountid=123&flag=11&money="+preferPrice),Tool.changeRoute("/product/detail",query)},$scope.question=function(){Tool.alert("如有疑问，请致电0755-26905699")}}});