define(function(){return function($scope,$rootScope,Tool,Ajax){$scope.cushs,$scope.noCush=!1,$scope.activeValue="",$scope.init=function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),Tool.checkLogin()?(Tool.loadUserinfo(),$scope.loadCush()):Tool.changeRoute("/user")},$scope.loadCush=function(){Ajax.post({url:Tool.host+"/wx/order/findAllVouchers",params:{userId:Tool.userInfo.id},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?0==data.data.length?$scope.noCush=!0:($scope.merge(data.data),$scope.cushs=data.data):Tool.alert("数据加载失败，请稍后再试!")})["catch"](function(){Tool.alert("数据加载失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.merge=function(items){items.forEach(function(item,index,array){item.flags>item.money?item.used=!0:item.uesd=!1})},$scope.active=function(){6==$scope.activeValue.length?Ajax.post({url:Tool.host+"/wx/order/activate",params:{userId:Tool.userInfo.id,code:$scope.activeValue},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?($scope.merge(data.data),$scope.cushs=data.data):Tool.alert("代金券不正确!")})["catch"](function(data){Tool.alert("代金券激活失败!")})["finally"](function(){$rootScope.loading=!1}):Tool.alert("请输入正确长度的代金券!")}}});