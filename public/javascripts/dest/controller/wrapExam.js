define(function(){return function($scope,$http,Tool,Ajax){$scope.loading=!1,$scope.noProduct=!1,$scope.noProductText="",$scope.products=[],$scope.queryParams={flag:1,city:"深圳",area:"",professionId:"6",itemId:"",currentPage:1},$scope.init=function(){Ajax.loadHost($scope,function(){$scope.loadProduct()})},window.onscroll=function(){if(!$scope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.loadProduct=function(){$scope.loading=!0;var url=$scope.host+"/wx/product/queryByMidd",params=Tool.convertParams($scope.queryParams);$http.post(url,params,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).success(function(data){0==data.code&&(data.data.length<1?($scope.products.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeProdcut(data.data),$scope.products=$scope.products.concat(data.data)),$scope.loading=!1)}).error(function(){$scope.loading=!1,$scope.noProduct=!0,Tool.alert($scope,"查询数据失败，请稍后再试！")})},$scope.mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype})},$scope.detail=function(proId,hosId){Tool.goPage("/new/htmls/exam-detail.html#?productId="+proId+"&hospitalId="+hosId)},$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.loadProduct()}}});