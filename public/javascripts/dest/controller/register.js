define(function(){return function($scope,$rootScope,$location,$interval,Tool,Ajax){$scope.phone="",$scope.password="",$scope.passwordAgian="",$scope.code="",$scope.codeText="获取短信验证码",$scope.referralCode="",$scope.codeState=!0,$scope.disable=!1,$scope.phoneCheckResult=!1,$scope.init=function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),$location.search().code&&($scope.referralCode=$location.search().code)},$scope.register=function(){$scope.check()&&$scope.codeCheck($scope.registering)},$scope.check=function(){return!!(/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)&&$scope.password.length>=8&&$scope.password.length<=20&$scope.password==$scope.passwordAgian)||(/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)?$scope.password.length<8|$scope.password.length>20?(Tool.alert("密码长度不符合要求，请输入8-20位的密码!"),!1):$scope.password!=$scope.passwordAgian?(Tool.alert("两次输入的密码不一致，请重新输入!"),!1):(Tool.alert("手机号码或者密码错误，请重新输入!"),!1):(Tool.alert("手机号码错误，请仔细检查!"),!1))},$scope.getCode=function(){$scope.codeState&&($scope.phoneCheckResult?Ajax.post({url:Tool.host+"/wx/register/sendsmsregistercode",params:{phone:$scope.phone}}).then(function(data){if(0==data.code){var time=59;$scope.codeState=!1;var interval=$interval(function(){$scope.codeText=time+" S",time--},1e3,60).then(function(){$scope.codeText="获取短信验证码",$scope.codeState=!0,$interval.cancel(interval)})}else Tool.alert(data.message)})["catch"](function(){Tool.alert("发送验证码失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1}):Tool.alert("请填写正确手机号码!"))},$scope.phoneCheck=function(){/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)?Ajax.post({url:Tool.host+"/wx/register/registercheck",params:{name:"phone",param:$scope.phone}}).then(function(data){0==data.code?$scope.phoneCheckResult=!0:Tool.alert(data.message)})["catch"](function(){Tool.alert("手机号码检查失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1}):($scope.phoneCheckResult=!1,Tool.alert("手机号码不正确！"))},$scope.codeCheck=function(callback){Ajax.post({url:Tool.host+"/wx/register/registercheck",params:{name:"verifyCode",param:$scope.code,p:$scope.phone}}).then(function(data){0==data.code?callback():Tool.alert(data.message)})["catch"](function(){Tool.alert("验证码验证失败，请重试!")})["finally"](function(){$rootScope.loading=!1})},$scope.registering=function(){Ajax.post({url:Tool.host+"/wx/register/register",params:{phone:$scope.phone,verifyCode:$scope.code,password:$scope.password,referralCode:$scope.referralCode}}).then(function(data){0==data.code?(Tool.setLocal("user",data.data),Tool.alert("注册成功!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/user")})):Tool.alert(data.message)})["catch"](function(){Tool.alert("注册失败!")})["finally"](function(){$rootScope.loading=!1})}}});