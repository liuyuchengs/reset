define(["require","exports"],function(require,exports){"use strict";function register($scope,$rootScope,$location,$interval,AjaxService,ToolService){$scope.phone="",$scope.password="",$scope.passwordAgian="",$scope.code="",$scope.codeText="获取短信验证码",$scope.referralCode="",$scope.codeState=!0,$scope.disable=!1,$scope.phoneCheckResult=!1,$scope.getCode=function(){$scope.codeState&&($scope.phoneCheckResult?AjaxService.post({url:ToolService.host+"/wx/register/sendsmsregistercode",data:{phone:$scope.phone}}).then(function(data){if(0==data.code){var time=59;$scope.codeState=!1;var interval=$interval(function(){$scope.codeText=time+" S",time--},1e3,60).then(function(){$scope.codeText="获取短信验证码",$scope.codeState=!0,$interval.cancel(interval)})}else ToolService.alert(data.message)}):ToolService.alert("请填写正确手机号码!"))},$scope.phoneCheck=function(){/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)?AjaxService.post({url:ToolService.host+"/wx/register/registercheck",data:{name:"phone",param:$scope.phone}}).then(function(data){0==data.code?$scope.phoneCheckResult=!0:ToolService.alert(data.message)}):($scope.phoneCheckResult=!1,ToolService.alert("手机号码不正确！"))};var check=function(){return!!(/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)&&$scope.password.length>=8&&$scope.password.length<=20&&$scope.password==$scope.passwordAgian)||(/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)?$scope.password.length<8||$scope.password.length>20?(ToolService.alert("密码长度不符合要求，请输入8-20位的密码!"),!1):$scope.password!=$scope.passwordAgian?(ToolService.alert("两次输入的密码不一致，请重新输入!"),!1):(ToolService.alert("手机号码或者密码错误，请重新输入!"),!1):(ToolService.alert("手机号码错误，请仔细检查!"),!1))},codeCheck=function(callback){AjaxService.post({url:ToolService.host+"/wx/register/registercheck",data:{name:"verifyCode",param:$scope.code,p:$scope.phone}}).then(function(data){0==data.code?callback():ToolService.alert(data.message)})};$scope.register=function(){check()&&codeCheck($scope.registering)},$scope.registering=function(){AjaxService.post({url:ToolService.host+"/wx/register/register",data:{phone:$scope.phone,verifyCode:$scope.code,password:$scope.password,referralCode:$scope.referralCode}}).then(function(data){0==data.code?(ToolService.setLocal("user",data.data),ToolService.alert("注册成功!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/user")})):ToolService.alert(data.message)})},ToolService.reset(),$rootScope.globalProp.hasBgColor=!0,$location.search().code&&($scope.referralCode=$location.search().code)}return register});