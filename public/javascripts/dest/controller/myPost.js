define(function(){return function($scope,$rootScope,$location,Ajax,Tool){$scope.params={hasPublish:!1,hasReply:!1},$scope.queryParams={pageRows:10,currentPage:1},$scope.item="",$scope.noProduct=!1,$scope.noProductText="",$scope.posts=[],$scope.replys=[],$scope.user={},$scope.init=function(){$rootScope.hasBgColor=!1,Tool.checkLogin()?(Tool.loadUserinfo(),$scope.getQuery()):Tool.changeRoute("/user")},$scope["switch"]=function(p){"publish"===p&&($scope.params.hasPublish=!0,$scope.posts=[],$scope.replys=[],$scope.queryParams.currentPage=1,$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.queryPost()},$scope.queryPost(),$scope.params.hasReply&&($scope.params.hasReply=!1)),"reply"===p&&($scope.params.hasReply=!0,$scope.posts=[],$scope.replys=[],$scope.queryParams.currentPage=1,$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.queryReply()},$scope.queryReply(),$scope.params.hasPublish&&($scope.params.hasPublish=!1))},$scope.clearData=function(){$scope.posts=[],$scope.replys=[],$scope.noProduct=!1,$scope.queryParams.currentPage=1},$scope.getQuery=function(){$location.search().item?($scope.item=$location.search().item,$scope["switch"]($scope.item)):Tool.changeRoute("/uesr")},$scope.queryReply=function(){Ajax.post({url:Tool.host+"/wx/repliesMessage/myReply",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0===data.code?data.data.length<1?($scope.replys.length<1?$scope.noProductText="您还没有评论哦!":$scope.noProductText="已经没有评论了!",$scope.noProduct=!0):(data.data.forEach(function(item){item.dataStr=item.createDateStr.slice(5,10)}),$scope.replys=$scope.replys.concat(data.data)):Tool.alert("获取评论信息失败!")})["catch"](function(){Tool.alert("获取帖子信息失败!")})["finally"](function(){$rootScope.loading=!1})},$scope.queryPost=function(){Ajax.post({url:Tool.host+"/wx/post/myPost",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){data.data.length<1?($scope.posts.length<1?$scope.noProductText="您还没有发布帖子!":$scope.noProductText="已经没有了!",$scope.noProduct=!0):(data.data.forEach(function(item){null!=item.visitNum&&""!=item.visitNum||(item.visitNum=0),""!=item.commentNum&&null!=item.commentNum||(item.commentNum=0)}),$scope.posts=$scope.posts.concat(data.data))})["catch"](function(){Tool.alert("获取帖子信息失败!")})["finally"](function(){$rootScope.loading=!1})},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.goPost=function(id){Tool.changeRoute("/interaction/detail","id="+id)},$scope.deletePost=function(id,$event){$event.stopPropagation(),Tool.comfirm("确定要删除吗?",function(){$rootScope.hasTip=!1,Ajax.post({url:Tool.host+"/wx/post/deletePost",params:{postId:id,accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code&&$scope.deleteObj(id,$scope.posts)})["catch"](function(){Tool.alert("删除失败!")})["finally"](function(){$rootScope.loading=!1})})},$scope.deleteReply=function(postid,id){Tool.comfirm("确定要删除吗?",function(){$rootScope.hasTip=!1,Ajax.post({url:Tool.host+"/wx/repliesMessage/deleteReplies",params:{postId:postid,repliesId:id,accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code&&$scope["switch"]("reply")})["catch"](function(){Tool.alert("删除失败!")})["finally"](function(){$rootScope.loading=!1})})},$scope.deleteObj=function(id,array){for(var index in array)array[index].id==id&&array.splice(index,1)}}});