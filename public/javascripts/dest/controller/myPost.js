define(["require","exports"],function(require,exports){"use strict";function myPost($scope,$rootScope,$location,AjaxService,ToolService){$scope.params={hasPublish:!1,hasReply:!1},$scope.queryParams={pageRows:10,currentPage:1},$scope.item="",$scope.posts=[],$scope.replys=[],$scope.user={},$scope["switch"]=function(p){"publish"===p&&($scope.params.hasPublish=!0,$scope.posts=[],$scope.replys=[],$scope.queryParams.currentPage=1,$rootScope.followTip.has=!1,$scope.loadNext=function(){$scope.queryParams.currentPage++,queryPost()},queryPost(),$scope.params.hasReply&&($scope.params.hasReply=!1)),"reply"===p&&($scope.params.hasReply=!0,$scope.posts=[],$scope.replys=[],$scope.queryParams.currentPage=1,$rootScope.followTip.has=!1,$scope.loadNext=function(){$scope.queryParams.currentPage++,queryReply()},queryReply(),$scope.params.hasPublish&&($scope.params.hasPublish=!1))};var getQuery=function(){$location.search().item?($scope.item=$location.search().item,$scope["switch"]($scope.item)):ToolService.changeRoute("/uesr")},queryReply=function(){AjaxService.post({url:ToolService.host+"/wx/repliesMessage/myReply",data:$scope.queryParams,headers:{accessToken:ToolService.user.accessToken}}).then(function(data){0===data.code?data.data.length<1?($scope.replys.length<1?$rootScope.followTip.val=$rootScope.followTip.empty:$rootScope.followTip.val=$rootScope.followTip.no,$rootScope.followTip.has=!0):(data.data.forEach(function(item){item.dataStr=item.createDateStr.slice(5,10)}),$scope.replys=$scope.replys.concat(data.data)):ToolService.alert("获取评论信息失败!")})},queryPost=function(){AjaxService.post({url:ToolService.host+"/wx/post/myPost",data:$scope.queryParams,headers:{accessToken:ToolService.user.accessToken}}).then(function(data){data.data.length<1?($scope.posts.length<1?$rootScope.followTip.val=$rootScope.followTip.empty:$rootScope.followTip.val=$rootScope.followTip.no,$rootScope.followTip.has=!0):(data.data.forEach(function(item){null!=item.visitNum&&""!=item.visitNum||(item.visitNum=0),""!=item.commentNum&&null!=item.commentNum||(item.commentNum=0)}),$scope.posts=$scope.posts.concat(data.data))})};$scope.goPost=function(id){ToolService.changeRoute("/interaction/detail","id="+id)},$scope.deletePost=function(id,$event){$event.stopPropagation(),ToolService.comfirm("确定要删除吗?",function(){$rootScope.messageTip.has=!1,AjaxService.post({url:ToolService.host+"/wx/post/deletePost",data:{postId:id,accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code&&deleteObj(id,$scope.posts)})})},$scope.deleteReply=function(postid,id){ToolService.comfirm("确定要删除吗?",function(){$rootScope.messageTip.has=!1,AjaxService.post({url:ToolService.host+"/wx/repliesMessage/deleteReplies",data:{postId:postid,repliesId:id,accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code&&$scope["switch"]("reply")})})};var deleteObj=function(id,array){for(var index in array)array[index].id==id&&array.splice(index,1)};ToolService.reset(),ToolService.checkLogin()?(ToolService.loadUser(),getQuery()):ToolService.changeRoute("/user"),ToolService.onWindowListen($scope.loadNext)}return myPost});