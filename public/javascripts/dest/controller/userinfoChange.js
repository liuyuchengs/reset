define(["require","exports","jquery"],function(require,exports,$){"use strict";function userChange($scope,$rootScope,$location,$timeout,$http,AjaxService,ToolService){$scope.title,$scope.tip,$scope.val="",$scope.hasImg=!1,$scope.input={has:!1,url:null},$scope.sexparams={men:!0,women:!1},$scope.payParams={flag:null,state:null,account:null,accessToken:null},$scope.titleParams={realname:"真实姓名",sex:"选择性别",phone:"手机号码",age:"年龄",nickname:"昵称",wxpay:"账号",alipay:"账号"},$scope.tipParams={realname:"请填写姓名",sex:"请填写性别",phone:"请填写手机号码",age:"请填写年龄",nickname:"请填写昵称",wxpay:"请填写微信账号",alipay:"请填写支付宝账号"};var listen=function(){$("#input1").on("change",function(){var url=$scope.getUrl(this.files[0]);$scope.input.has=!0,$scope.input.url=url,$scope.$apply()})};$scope.getUrl=function(obj){var url=null;return void 0!=window.URL&&(url=window.URL.createObjectURL(obj)),url},$scope.choosePic=function(){$timeout(function(){$("#input1").click()},0)},$scope.removePic=function(){$scope.input.has=!1,$scope.input.url="";var element=document.getElementById("input1");element.outerHTML=element.outerHTML,listen()},$scope.check=function(){return 0==$scope.val.length?(ToolService.alert("填写内容为空！"),!1):"realname"==$scope.item||"nickname"==$scope.item?$scope.val.length>1&&$scope.val.length<10||(ToolService.alert("请输入正确长度的名称！"),!1):"sex"==$scope.item?"男"==$scope.val||"女"==$scope.val||(ToolService.alert("请输入正确的性别！"),!1):"phone"==$scope.item?!!/^1[3|4|5|7|8]\d{9}$/.test($scope.val)||(ToolService.alert("请输入正确的手机号码!"),!1):"age"==$scope.item?parseInt($scope.val)>0&&parseInt($scope.val)<150?($scope.val=parseInt($scope.val),!0):(ToolService.alert("请输入正确的年龄!"),!1):"wxpay"==$scope.item||"alipay"==$scope.item?!($scope.val.length<3)||(ToolService.alert("长度过低!"),!1):"img"==$scope.item?!!$scope.input.has||(ToolService.alert("请选择照片"),!1):(ToolService.alert("未识别需要修改的项目,请稍后再试!"),!1)},$scope.select=function(value){if("男"==value){if(!$scope.sexparams.men)return $scope.sexparams.men=!0,$scope.sexparams.women=!1,void($scope.val="男")}else(value="女")&&($scope.sexparams.women||($scope.sexparams.men=!1,$scope.sexparams.women=!0,$scope.val="女"))},$scope.change=function(){if(ToolService.checkLogin())if("wxpay"===$scope.item||"alipay"===$scope.item)$scope.payParams.account=$scope.val,$scope.payParams.accessToken=ToolService.user.accessToken,AjaxService.post({url:ToolService.host+"/wx/withDraw/bound",data:$scope.payParams}).then(function(data){0==data.code?(1==$scope.payParams.flag&&(ToolService.user.alipay=$scope.val),2==$scope.payParams.flag&&(ToolService.user.wxpay=$scope.val),ToolService.setLocal("user",ToolService.user),ToolService.alert("绑定成功!",function(){$rootScope.messageTip.has=!1,ToolService.changeRoute("/user/userinfo")})):ToolService.alert("绑定失败,请稍后再试!")});else{$rootScope.load.has=!0;var infoData=new FormData,url=ToolService.host+"/wx/mycount/updateUserInfo";infoData.append("name",$scope.item),infoData.append("val",$scope.val),$scope.input.has?infoData.append("headImage",$("#input1").get(0).files[0]):infoData.append("headImage",new Blob([""],{type:"image/jpeg"})),$http.post(url,infoData,{headers:{accessToken:ToolService.user.accessToken,"Content-Type":void 0}}).success(function(data){$rootScope.load.has=!1,0==data.code?(ToolService.setLocal("user",data.data),ToolService.changeRoute("/user/userinfo")):1==data.code&&ToolService.alert(data.message)}).error(function(){$rootScope.load.has=!1,ToolService.alert("数据更新失败!")})}},ToolService.reset(),$rootScope.globalProp.hasBgColor=!0,ToolService.checkLogin()?(ToolService.loadUser(),$scope.item=$location.search().item,$scope.title=$scope.titleParams[$scope.item],$scope.tip=$scope.tipParams[$scope.item],"sex"==$scope.item?($scope.hassex=!0,$scope.val="男"):$scope.hasinput=!0,"img"===$scope.item?($scope.hasImg=!0,$scope.val="img",listen()):$scope.hasImg=!1,"wxpay"===$scope.item&&($scope.payParams.flag=2),"alipay"===$scope.item&&($scope.payParams.flag=1),$location.search().state&&($scope.payParams.state=$location.search().state)):ToolService.changeRoute("/user")}return userChange});