define(function(){return function($scope,$rootScope,$location,$interval,Tool,Ajax){$scope.phone="",$scope.code="",$scope.pwd="",$scope.getPhone=$location.search().phone||"",$scope.getCodes=$location.search().code||"",$scope.hasSendCode=!1,$scope.codeText="获取短信验证码",$scope.sendCodes=!1,angular.element(document).ready(function(){Tool.noWindowListen(),$rootScope.hasBgColor=!0}),$scope.checkPhone=function(){/^1[3|4|5|7|8]\d{9}$/.test($scope.phone)?Ajax.post({url:Tool.host+"/wx/findpass/findPassPhontCheck",params:{name:"phone",param:$scope.phone}}).then(function(data){0==data.code?Tool.changeRoute("/findpwd/code","phone="+$scope.phone):Tool.alert(data.message)})["catch"](function(){Tool.alert("检查手机号码失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1}):Tool.alert("请输入正确的手机号码!")},$scope.checkCode=function(){$scope.sendCodes?4==$scope.code.length?Ajax.post({url:Tool.host+"/wx/findpass/findPassPhontCheck",params:{name:"verifyCode",param:$scope.code,p:$scope.getPhone}}).then(function(data){0==data.code?Tool.changeRoute("/findpwd/pwd","phone="+$scope.getPhone+"&code="+$scope.code):Tool.alert(date.message)})["catch"](function(){Tool.alert("验证码错误!")})["finally"](function(){$rootScope.loading=!1}):Tool.alert("请输入4位验证码"):Tool.alert("请先获取验证码")},$scope.changePwd=function(){$scope.pwd.length>=8&&$scope.pwd.length<=20&&Ajax.post({url:Tool.host+"/wx/findpass/changepwd",params:{phone:$scope.getPhone,code:$scope.getCodes,password:$scope.pwd}}).then(function(data){0==data.code?Tool.alert("密码修改成功!",function(){$rootScope.hasTip=!1,Tool.changeRoute("/login")}):Tool.alert(data.message)})["catch"](function(){Tool.alert("密码修改失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.getCode=function(){$scope.hasSendCode||Ajax.post({url:Tool.host+"/wx/findpass/sendsmsfindpasscode",params:{phone:$scope.getPhone}}).then(function(data){if(0==data.code){$scope.hasSendCode=!0,$scope.sendCodes=!0;var time=59,interval=$interval(function(){$scope.codeText=time+" S",time--},1e3,60).then(function(){$scope.codeText="获取短信验证码",$scope.hasSendCode=!1,$interval.cancel(interval)})}else Tool.alert(data.mesage)})["catch"](function(){Tool.alert("发送验证码失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})}}});