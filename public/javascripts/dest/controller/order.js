define(function(){return function($scope,$rootScope,$location,Ajax,Tool){$scope.orders,$scope.cancelOrderId,$scope.noOrder=!1,$scope.status="",$scope.btnParams={toPay:!1,payed:!1,canceled:!1,tocancel:!1,finish:!1},$scope.filterParams={all:{has:!1,val:""},toPay:{has:!1,val:"0"},toHos:{has:!1,val:"2"},toAssess:{has:!1,val:"4"}},$scope.init=function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),Tool.checkLogin()?(Tool.loadUserinfo(),$scope.getParams(),$scope.loadOrder()):Tool.changeRoute("/user")},$scope.getParams=function(){if($location.search().p){var params=$location.search().p;$scope.filterParams[params].has=!0,$scope.status=$scope.filterParams[params].val}},$scope.loadOrder=function(){Ajax.post({url:Tool.host+"/wx/order/queryOrderList",params:{userId:Tool.userInfo.id,status:$scope.status},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?(0==data.data.length?$scope.noOrder=!0:($scope.noOrder=!1,$scope.merge(data.data)),$scope.orders=data.data):1==data.code?Tool.alert(data.message):Tool.alert("获取订单信息失败，请稍后再试!")})["catch"](function(){Tool.alert("获取订单信息失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.merge=function(orders){orders.forEach(function(item,index,array){switch(item.toPay=!1,item.payed=!1,item.canceled=!1,item.tocancel=!1,item.finish=!1,item.status){case-1:item.statusMes="已取消",item.canceled=!0;break;case 0:item.statusMes="待支付",item.toPay=!0,item.tocancel=!0;break;case 1:item.statusMes="待确认",item.payed=!0,item.tocancel=!0;break;case 2:item.statusMes="待就医",item.payed=!0,item.tocancel=!0;break;case 3:item.statusMes="就医中",item.payed=!0;break;case 4:item.statusMes="就医完成",item.finish=!0;break;case 5:item.statusMes="就医完成",item.finish=!0;break;case 6:item.statusMes="退款中";break;case 7:item.statusMes="退款完成",item.finish=!0}item.discountprice=parseFloat(item.discountprice).toFixed(2)})},$scope.toPay=function(order){Tool.setSession("order",order);var appid="wx0229404bc9eeea00",redirect_uri=Tool.host+"/v2/htmls/temp.html",url="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+redirect_uri+"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect";Tool.goUrl(url)},$scope.toCancel=function(id){$scope.cancelOrderId=id,Tool.comfirm("确定要取消订单吗？",$scope.cancelFn)},$scope.cancelFn=function(){$rootScope.hasTip&&($rootScope.hasTip=!1),Ajax.post({url:Tool.host+"/wx/order/orderCacel",params:{id:$scope.cancelOrderId},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?($scope.status="",$scope.loadOrder()):1==data.code&&Tool.alert("订单取消失败，请稍后再试!")})["catch"](function(){Tool.alert("订单取消失败!")})["finally"](function(){$rootScope.loading=!1})},$scope.switchOrder=function(item){Tool.select(item,$scope.filterParams),$scope.status=$scope.filterParams[item].val,$scope.loadOrder()}}});