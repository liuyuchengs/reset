define(["require","exports"],function(require,exports){"use strict";function order($scope,$rootScope,$location,AjaxService,ToolService){$scope.orders,$scope.cancelOrderId,$scope.noOrder=!1,$scope.status="",$scope.btnParams={toPay:!1,payed:!1,canceled:!1,tocancel:!1,finish:!1},$scope.filterParams=[{has:!1,val:"全部",id:""},{has:!1,val:"待付款",id:0},{has:!1,val:"待就医",id:2},{has:!1,val:"待评价",id:4}];var getParams=function(){if($location.search().p){var params=$location.search().p,index=null;switch(params){case"all":index=0;break;case"toPay":index=1;break;case"toHos":index=2;break;case"toAssess":index=3}$scope.filterParams[index].has=!0,$scope.status=$scope.filterParams[index].id}},loadOrder=function(){AjaxService.post({url:ToolService.host+"/wx/order/queryOrderList",data:{userId:ToolService.user.id,status:$scope.status},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code?(0==data.data.length?$scope.noOrder=!0:($scope.noOrder=!1,merge(data.data)),$scope.orders=data.data):1==data.code?ToolService.alert(data.message):ToolService.alert("获取订单信息失败，请稍后再试!")})},merge=function(orders){orders.forEach(function(item,index,array){switch(item.toPay=!1,item.payed=!1,item.canceled=!1,item.tocancel=!1,item.finish=!1,item.status){case-1:item.statusMes="已取消",item.canceled=!0;break;case 0:item.statusMes="待支付",item.toPay=!0,item.tocancel=!0;break;case 1:item.statusMes="待确认",item.payed=!0,item.tocancel=!0;break;case 2:item.statusMes="待就医",item.payed=!0,item.tocancel=!0;break;case 3:item.statusMes="就医中",item.payed=!0;break;case 4:item.statusMes="就医完成",item.finish=!0;break;case 5:item.statusMes="就医完成",item.finish=!0;break;case 6:item.statusMes="退款中";break;case 7:item.statusMes="退款完成",item.finish=!0}item.discountprice=parseFloat(item.discountprice).toFixed(2)})};$scope.toPay=function(order){ToolService.setSession("order",order);var appid="wx0229404bc9eeea00",redirect_uri=ToolService.host+"/v2/htmls/temp.html",url="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+redirect_uri+"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect";ToolService.toUrl(url)},$scope.toCancel=function(id){$scope.cancelOrderId=id,ToolService.comfirm("确定要取消订单吗？",cancelFn)};var cancelFn=function(){$rootScope.messageTip.has=!1,AjaxService.post({url:ToolService.host+"/wx/order/orderCacel",data:{id:$scope.cancelOrderId},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){0==data.code?($scope.status="",loadOrder()):1==data.code&&ToolService.alert("订单取消失败，请稍后再试!")})};$scope.switchOrder=function(index){ToolService.select(index,$scope.filterParams),$scope.status=$scope.filterParams[index].id,loadOrder()},ToolService.reset(),$rootScope.globalProp.hasBgColor=!0,ToolService.checkLogin()?(ToolService.loadUser(),getParams(),loadOrder()):ToolService.changeRoute("/user")}return order});