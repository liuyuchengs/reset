define(function(){return function($scope,$rootScope,$location,Tool,Ajax){$scope.queryParams={productId:"",hospitalId:"",dayDate:"",code:""},$scope.userInfo={},$scope.loadQueryParams=function(){$location.search().productId&&($scope.queryParams.productId=$location.search().productId),$location.search().hospitalId&&($scope.queryParams.hospitalId=$location.search().hospitalId),$location.search().dayDate&&($scope.queryParams.dayDate=$location.search().dayDate)},angular.element(document).ready(function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),$scope.loadQueryParams(),Tool.checkLogin()&&Tool.loadUserinfo()}),$scope.checkCode=function(){$scope.queryParams.code.length<1?Tool.alert("请填写惠赠码!"):5!=$scope.queryParams.code.length?Tool.alert("惠赠码错误，请填写正确的惠赠码！如需帮助请致电：0755-26905699"):5==$scope.queryParams.code.length&&Ajax.post({url:Tool.host+"/wx/order/checkCode",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code?$scope.getGift($scope.queryParams):Tool.alert(data.message)})["catch"](function(){Tool.alert("数据连接失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.getGift=function(queryParams){Ajax.post({url:Tool.host+"/wx/gift/getgiftproduct",params:queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){if(0==data.code){var user=Tool.getLocal("user");user.giftCode=0,Tool.setLocal("user",user),Tool.setLocal("gift",data.data),Tool.changeRoute("/grab/order")}})["catch"](function(){Tool.alert("连接数据失败，请稍后再试！")})["finally"](function(){$rootScope.loading=!1})}}});