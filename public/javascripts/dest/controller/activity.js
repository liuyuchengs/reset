define(function(){return function($scope,$rootScope,$location,Tool,Ajax){$scope.queryParams={pageRows:10,currentPage:1,flag:null},$scope.noProduct=!1,$scope.noProductText="",$scope.products=[],$scope.init=function(){$rootScope.hasBgColor=!1,$location.search().flag?($scope.queryParams.flag=$location.search().flag,$scope.queryActivity()):Tool.changeRoute("/home")},$scope.queryActivity=function(){Ajax.post({url:Tool.host+"/wx/product/queryActivity",params:$scope.queryParams}).then(function(data){0===data.code&&(data.data.length<1?($scope.products.length<1?$scope.noProductText="暂无数据":$scope.noProductText="已经没有了!",$scope.noProduct=!0):($scope.mergeActivity(data.data),$scope.products=$scope.products.concat(data.data)))})["catch"](function(){Tool.alert("获取数据失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeActivity=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype,""!=item.samllimg&&null!=item.samllimg||(item.samllimg="../contents/img/p_default.png"),6===item.type&&(item.hasActivity=!0)})},$scope.detail=function(productId,hospitalId,type){productId&&hospitalId&&type&&(5===type&&Tool.changeRoute("/exam/detail","productId="+productId+"&hospitalId="+hospitalId),6===type?Tool.changeRoute("/exam/detail","productId="+productId+"&hospitalId="+hospitalId+"&activityp=元/次"):Tool.changeRoute("/product/detail","productId="+productId+"&hospitalId="+hospitalId))},$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.queryActivity()},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}}}});