define(["require","exports"],function(require,exports){"use strict";function exam($scope,$rootScope,$location,ToolService,AjaxService){$scope.products=[],$scope.hospitals=[],$scope.params={product:!1,hospital:!1},$scope.productQueryParams={city:"深圳",area:"",professionId:5,itemId:"",order:"",specialty:"",currentPage:1,pageRows:10},$scope.hospitalQueryParams={city:"深圳",area:null,professionId:5,order:null,currentPage:1,pageRows:10},$scope.sexParams=ToolService.sexParams,$scope.areaParams=ToolService.areaParams,$scope.classParams=ToolService.tijianParams,$scope.orderParams=ToolService.orderParams,$scope.menuParams=[{has:!1,val:"区域",children:$scope.areaParams},{has:!1,val:"排序",children:$scope.orderParams},{has:!1,val:"类别",children:$scope.classParams},{has:!1,val:"性别",children:$scope.sexParams}],$scope["switch"]=function(item){for(var proto in $scope.params)proto===item?$scope.params[item]=!0:$scope.params[proto]=!1;setNext(item),"product"===item&&($scope.products=[],$scope.productQueryParams.currentPage=1,loadProduct()),"hospital"===item&&($scope.hospitals=[],$scope.hospitalQueryParams.currentPage=1,loadHospital())},$scope.switchMenu=function(index,obj){ToolService.select(index,obj,!0),$rootScope.globalProp.hasBlackBg=obj[index].has},$scope.switchDrop=function(index,obj){ToolService.select(index,obj),obj===$scope.areaParams&&($scope.menuParams[0].has=!1,$scope.productQueryParams.area=obj[index].id),obj===$scope.orderParams&&($scope.menuParams[1].has=!1,$scope.productQueryParams.order=obj[index].id),obj===$scope.classParams&&($scope.menuParams[2].has=!1,$scope.productQueryParams.itemId=obj[index].id),obj===$scope.sexParams&&($scope.menuParams[3].has=!1,$scope.productQueryParams.specialty=obj[index].id),$rootScope.globalProp.hasBlackBg=!1,$scope.productQueryParams.currentPage=0,$scope.products=[],$rootScope.followTip.has=!1,loadProduct()};var loadProduct=function(){AjaxService.post({url:ToolService.host+"/wx/product/querylist",data:$scope.productQueryParams}).then(function(data){data.length<1?($scope.products.length<1?$rootScope.followTip.val=$rootScope.followTip.empty:$rootScope.followTip.val=$rootScope.followTip.no,$rootScope.followTip.has=!0):(mergeProdcut(data),$scope.products=$scope.products.concat(data))})},loadHospital=function(){AjaxService.post({url:ToolService.host+"/wx/hospital/querylist",data:$scope.hospitalQueryParams}).then(function(data){data.list.length>0?(data.list.forEach(function(item){""!=item.score&&null!=item.score||(item.score="暂无评分")}),$scope.hospitals=$scope.hospitals.concat(data.list)):($scope.hospitals.length<1?$rootScope.followTip.val=$rootScope.followTip.empty:$rootScope.followTip.val=$rootScope.followTip.no,$rootScope.followTip.has=!1)})};$scope.detail=function(proId,hosId){ToolService.changeRoute("/exam/detail","productId="+proId+"&hospitalId="+hosId)};var mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype})},getQuery=function(){if($location.search().item){var proto=$location.search().item;$scope["switch"](proto)}else ToolService.changeRoute("/home")},setNext=function(item){"product"===item&&ToolService.onWindowListen(function(){$scope.productQueryParams.currentPage++,loadProduct()}),"hospital"===item&&ToolService.onWindowListen(function(){$scope.hospitalQueryParams.currentPage++,loadHospital()})};ToolService.reset(),getQuery()}return exam});