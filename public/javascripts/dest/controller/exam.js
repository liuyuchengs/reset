define(function(){return function($scope,$rootScope,$location,Tool,Ajax){$scope.params={product:!1,hospital:!1},$scope.noProduct=!1,$scope.noProductText="",$scope.products=[],$scope.hospitals=[],$scope.productParams={city:"深圳",area:"",professionId:5,itemId:"",order:"",specialty:"",currentPage:1,pageRows:10},$scope.hospitalParams={city:"深圳",area:null,professionId:5,order:null,currentPage:1,pageRows:10},$scope.hasBg=!1,$scope.hasOrder=!1,$scope.hasArea=!1,$scope.hasClass=!1,$scope.hasSex=!1,$scope.menuParams={area:!1,order:!1,classes:!1,sex:!1},$scope.orderParams={"default":{has:!0,val:""},price:{has:!1,val:"prefer_price asc"},priceDesc:{has:!1,val:"prefer_price desc"},scoreDesc:{has:!1,val:"hospital_score asc"},countDesc:{has:!1,val:"sales desc"}},$scope.areaParams={"default":{has:!0,val:""},futian:{has:!1,val:"福田区"},nanshan:{has:!1,val:"南山区"},luohu:{has:!1,val:"罗湖区"},baoan:{has:!1,val:"宝安区"},longhua:{has:!1,val:"龙华新区"},longgang:{has:!1,val:"龙岗区"},yantian:{has:!1,val:"盐田"}},$scope.classParams={"default":{has:!0,val:""},shangye:{has:!1,val:75},changgui:{has:!1,val:67},zhongnian:{has:!1,val:69},laonian:{has:!1,val:70},ruzhi:{has:!1,val:71},yunqian:{has:!1,val:72},qingnian:{has:!1,val:68},ertong:{has:!1,val:74},manbing:{has:!1,val:73}},$scope.sexParams={"default":{has:!0,val:"通用"},men:{has:!1,val:"男"},women:{has:!1,val:"女"}},$scope.init=function(){$scope.getQuery()},$scope["switch"]=function(item){for(var proto in $scope.params)proto===item?$scope.params[item]=!0:$scope.params[proto]=!1;$scope.setNext(item),"product"===item&&($scope.products=[],$scope.productParams.currentPage=1,$scope.loadProduct()),"hospital"===item&&($scope.hospitals=[],$scope.hospitalParams.currentPage=1,$scope.loadHospital())},$scope.getQuery=function(){if($location.search().item){var proto=$location.search().item;$scope["switch"](proto)}else Tool.changeRoute("/home")},$scope.switchMenu=function(menu){switch(menu){case"area":$scope.hasOrder&&($scope.hasOrder=!1,$scope.menuParams.order=!1),$scope.hasClass&&($scope.hasClass=!1,$scope.menuParams.classes=!1),$scope.hasSex&&($scope.hasSex=!1,$scope.menuParams.sex=!1),$scope.hasArea=!$scope.hasArea,$scope.hasArea?$scope.menuParams.area=!0:$scope.menuParams.area=!1;break;case"order":$scope.hasArea&&($scope.hasArea=!1,$scope.menuParams.area=!1),$scope.hasClass&&($scope.hasClass=!1,$scope.menuParams.classes=!1),$scope.hasSex&&($scope.hasSex=!1,$scope.menuParams.sex=!1),$scope.hasOrder=!$scope.hasOrder,$scope.hasOrder?$scope.menuParams.order=!0:$scope.menuParams.order=!1;break;case"class":$scope.hasOrder&&($scope.hasOrder=!1,$scope.menuParams.order=!1),$scope.hasArea&&($scope.hasArea=!1,$scope.menuParams.area=!1),$scope.hasSex&&($scope.hasSex=!1,$scope.menuParams.sex=!1),$scope.hasClass=!$scope.hasClass,$scope.hasClass?$scope.menuParams.classes=!0:$scope.menuParams.classes=!1;break;case"sex":$scope.hasOrder&&($scope.hasOrder=!1,$scope.menuParams.order=!1),$scope.hasArea&&($scope.hasArea=!1,$scope.menuParams.area=!1),$scope.hasClass&&($scope.hasClass=!1,$scope.menuParams.classes=!1),$scope.hasSex=!$scope.hasSex,$scope.hasSex?$scope.menuParams.sex=!0:$scope.menuParams.sex=!1}$scope.hasOrder||$scope.hasArea||$scope.hasClass||$scope.hasSex?$scope.hasBg=!0:$scope.hasBg=!1},$scope.areaSelect=function(params){Tool.select(params,$scope.areaParams),$scope.productParams.area=$scope.areaParams[params].val,$scope.productParams.currentPage=0,$scope.products=[],$scope.noProduct=!1,$scope.loadProduct(),$scope.switchMenu("area")},$scope.orderSelect=function(params){Tool.select(params,$scope.orderParams),$scope.productParams.order=$scope.orderParams[params].val,$scope.productParams.currentPage=0,$scope.products=[],$scope.noProduct=!1,$scope.loadProduct(),$scope.switchMenu("order")},$scope.classSelect=function(params){Tool.select(params,$scope.classParams),$scope.productParams.itemId=$scope.classParams[params].val,$scope.productParams.currentPage=0,$scope.products=[],$scope.noProduct=!1,$scope.loadProduct(),$scope.switchMenu("class")},$scope.sexSelect=function(params){Tool.select(params,$scope.sexParams),$scope.productParams.specialty=$scope.sexParams[params].val,$scope.productParams.currentPage=0,$scope.products=[],$scope.noProduct=!1,$scope.loadProduct(),$scope.switchMenu("sex")},$scope.loadProduct=function(){Ajax.post({url:Tool.host+"/wx/product/querylist",params:$scope.productParams}).then(function(data){data.length<1?($scope.products.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeProdcut(data),$scope.products=$scope.products.concat(data))})["catch"](function(){$scope.noProduct=!0,Tool.alert("查询数据失败，请稍后再试！")})["finally"](function(){$rootScope.loading=!1})},$scope.loadHospital=function(){Ajax.post({url:Tool.host+"/wx/hospital/querylist",params:$scope.hospitalParams}).then(function(data){data.list.length>0?(data.list.forEach(function(item){""!=item.score&&null!=item.score||(item.score="暂无评分")}),$scope.hospitals=$scope.hospitals.concat(data.list)):($scope.hospitals.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0)})["catch"](function(){Tool.alert("加载数据失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype})},$scope.detail=function(proId,hosId){Tool.changeRoute("/exam/detail","productId="+proId+"&hospitalId="+hosId)},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.setNext=function(item){"product"===item&&($scope.loadNext=function(){$scope.productParams.currentPage++,$scope.loadProduct()}),"hospital"===item&&($scope.loadNext=function(){$scope.hospitalParams.currentPage++,$scope.loadHospital()})}}});