define(function(){return function($scope,$rootScope,$location,Tool,Ajax){$scope.params={doctor:!1,user:!0,product:!1},$scope.queryParams={pageRows:10,currentPage:1,flag:1},$scope.follows=[],$scope.noProduct=!1,$scope.noProductText="",$scope.init=function(){$rootScope.hasBgColor=!1,Tool.checkLogin()?(Tool.loadUserinfo(),$scope.getQuery()):Tool.changeRoute("/user")},$scope.getQuery=function(){$location.search().item?$scope["switch"]($location.search().item):Tool.changeRoute("/user")},$scope["switch"]=function(item){for(var proto in $scope.params)proto==item?$scope.params[proto]=!0:$scope.params[proto]=!1;$scope.clearData(),"user"===item&&($scope.setNext($scope.queryUser),$scope.queryUser()),"doctor"===item&&($scope.setNext($scope.queryDoctor),$scope.queryDoctor()),"product"===item&&($scope.setNext($scope.queryProduct),$scope.queryProduct())},$scope.clearData=function(){$scope.follows=[],$scope.noProduct=!1,$scope.noProductText="",$scope.queryParams.currentPage=1},$scope.queryUser=function(){$scope.queryParams.flag=1,Ajax.post({url:Tool.host+"/wx/focus/focusUserMan",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0===data.code?data.data.length<1?($scope.follows.length<1?$scope.noProductText="您还没有关注其他人!":$scope.noProductText="已经没有了!",$scope.noProduct=!0):(data.data.forEach(function(item){item.hasFollow=!0,item.followText="已关注"}),$scope.follows=$scope.follows.concat(data.data)):Tool.alert("数据连接失败，请稍后再试!")})["catch"](function(){Tool.alert("数据连接失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.queryDoctor=function(){$scope.queryParams.flag=2,Ajax.post({url:Tool.host+"/wx/focus/focusDoctorMan",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0===data.code?data.data.length<1?($scope.follows.length<1?$scope.noProductText="您还没有关注医生!":$scope.noProductText="已经没有了!",$scope.noProduct=!0):(data.data.forEach(function(item){item.hasFollow=!0,item.followText="已关注"}),$scope.follows=$scope.follows.concat(data.data)):Tool.alert("数据连接失败，请稍后再试!")})["catch"](function(){Tool.alert("连接数据失败,请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.queryProduct=function(){$scope.queryParams.flag=3,Ajax.post({url:Tool.host+"/wx/focus/focusProductMan",params:$scope.queryParams,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0===data.code?data.data.length<1?($scope.follows.length<1?$scope.noProductText="您还没有关注项目!":$scope.noProductText="已经没有了!",$scope.noProduct=!0):(data.data.forEach(function(item){item.hasFollow=!0,item.followText="已关注"}),$scope.follows=$scope.follows.concat(data.data)):Tool.alert("数据连接失败，请稍后再试!")})["catch"](function(){Tool.alert("连接数据失败,请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.switchFollow=function(id,flag){if(Tool.checkLogin()){if(Tool.loadUserinfo(),$scope.selectFollow(id)){var follow=$scope.selectFollow(id);follow.hasFollow?$scope.cacelFollow(id,flag):$scope.tofollow(id,flag)}}else Tool.comfirm("请先登录!",function(){$rootScope.loading=!1,Tool.changeRoute("/login")})},$scope.tofollow=function(id,flag){Ajax.post({url:Tool.host+"/wx/post/focus",params:{flag:flag,userId:id},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){if(0==data.code){if($scope.selectFollow(id)){var follow=$scope.selectFollow(id);follow.hasFollow=!0,follow.followText="已关注"}}else Tool.alert("关注失败，稍后再试!")})["catch"](function(){Tool.alert("连接数据失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.cacelFollow=function(id,flag){Ajax.post({url:Tool.host+"/wx/post/cacelFocus",params:{flag:flag,userId:id},headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){if(0==data.code){if($scope.selectFollow(id)){var follow=$scope.selectFollow(id);follow.hasFollow=!1,follow.followText="关注"}}else Tool.alert("取消关注失败，稍后再试!")})["catch"](function(){Tool.alert("连接数据失败，稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.selectFollow=function(id){for(var proto in $scope.follows){var follow=$scope.follows[proto];if(follow.id==id)return follow}},$scope.setNext=function(fn){$scope.loadNext=function(){$scope.queryParams.currentPage++,fn()}},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}}}});