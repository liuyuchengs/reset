define(["require","exports"],function(require,exports){"use strict";function makeorder($scope,$rootScope,ToolService,AjaxService){$scope.hasCheck=!1,$scope.hasGift=!1,$scope.noUserInfo=!0,$scope.giftText="本订单无可用代金券",$scope.orderInfo=null,$scope.hasDoctor=!0,$scope.selectCush=function(){if($scope.hasGift){$scope.hasCheck=!$scope.hasCheck;var payMoney=parseFloat($scope.orderInfo.payMoney),giftMoney=parseFloat($scope.orderInfo.giftMoney);$scope.hasCheck?$scope.orderInfo.payMoney=payMoney-giftMoney:($scope.orderInfo.payMoney=payMoney+giftMoney,$scope.orderInfo.flag=null),$scope.orderInfo.payMoney.toFixed(1)}};var checkGift=function(){parseFloat($scope.orderInfo.giftMoney)>0&&($scope.hasCheck=!0,$scope.hasGift=!0,$scope.giftText="本订单可使用代金券￥"),""!=$scope.orderInfo.doctorName&&null!=$scope.orderInfo.doctorName||($scope.hasDoctor=!1)};$scope.makeorder=function(){var params={productId:$scope.orderInfo.productId,scheduleId:$scope.orderInfo.scheduleId,patientName:$scope.orderInfo.patientName,patientTelephone:$scope.orderInfo.patientTelephone,dealMoney:$scope.orderInfo.dealMoney,realMoney:$scope.orderInfo.realMoney,payMoney:$scope.orderInfo.payMoney};$scope.orderInfo.code&&(params.code=$scope.orderInfo.code),$scope.orderInfo.flag&&(params.flag=$scope.orderInfo.flag),AjaxService.post({url:ToolService.host+"/wx/order/make",data:params,headers:{accessToken:ToolService.user.accessToken}}).then(function(data){if(0==data.code){ToolService.removeSession("makeorder"),ToolService.setSession("order",data.data);var appid="wx0229404bc9eeea00",redirect_uri=ToolService.host+"/v2/htmls/temp.html",href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+redirect_uri+"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect";ToolService.toUrl(href)}else ToolService.alert(data.message)})},$scope.back=function(){window.history.back()},ToolService.reset(),$rootScope.globalProp.hasBgColor=!1,ToolService.checkLogin()&&ToolService.getSession("makeorder")?(ToolService.loadUser(),$scope.orderInfo=ToolService.getSession("makeorder"),$scope.orderInfo.patientName=ToolService.getLocal("user").realname,$scope.orderInfo.patientTelephone=ToolService.getLocal("user").phone,checkGift()):ToolService.changeRoute("/home")}return makeorder});