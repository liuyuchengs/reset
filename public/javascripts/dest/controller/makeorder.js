define(function(){return function($scope,$rootScope,Tool,Ajax){$scope.hasCheck=!1,$scope.hasGift=!1,$scope.noUserInfo=!0,$scope.giftText="本订单无可用代金券",$scope.orderInfo=Tool.getSession("makeorder"),$scope.orderInfo.patientName=Tool.getLocal("user").realname,$scope.orderInfo.patientTelephone=Tool.getLocal("user").phone,$scope.userInfo,$scope.hasDoctor=!0,$scope.init=function(){$rootScope.hasBgColor=!1,Tool.noWindowListen(),Tool.loadUserinfo(),$scope.checkGift()},$scope.selectCush=function(){if($scope.hasGift){$scope.hasCheck=!$scope.hasCheck;var payMoney=parseFloat($scope.orderInfo.payMoney),giftMoney=parseFloat($scope.orderInfo.giftMoney);$scope.hasCheck?$scope.orderInfo.payMoney=payMoney-giftMoney:($scope.orderInfo.payMoney=payMoney+giftMoney,$scope.orderInfo.flag=null),$scope.orderInfo.payMoney.toFixed(1)}},$scope.checkGift=function(){parseFloat($scope.orderInfo.giftMoney)>0&&($scope.hasCheck=!0,$scope.hasGift=!0,$scope.giftText="本订单可使用代金券￥"),""!=$scope.orderInfo.doctorName&&null!=$scope.orderInfo.doctorName||($scope.hasDoctor=!1)},$scope.makeorder=function(){var params={productId:$scope.orderInfo.productId,scheduleId:$scope.orderInfo.scheduleId,patientName:$scope.orderInfo.patientName,patientTelephone:$scope.orderInfo.patientTelephone,dealMoney:$scope.orderInfo.dealMoney,realMoney:$scope.orderInfo.realMoney,payMoney:$scope.orderInfo.payMoney};$scope.orderInfo.code&&(params.code=$scope.orderInfo.code),$scope.orderInfo.flag&&(params.flag=$scope.orderInfo.flag),Ajax.post({url:Tool.host+"/wx/order/make",params:params,headers:{accessToken:Tool.userInfo.accessToken}}).then(function(data){if(0==data.code){Tool.removeSession("makeorder"),Tool.setSession("order",data.data);var appid="wx0229404bc9eeea00",redirect_uri=Tool.host+"/v2/htmls/temp.html",href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+appid+"&redirect_uri="+redirect_uri+"&response_type=code&scope=snsapi_base&state=uokang#wechat_redirect";Tool.goUrl(href)}else Tool.alert(data.message)})["catch"](function(){Tool.alert("创建订单失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.back=function(){window.history.back()}}});