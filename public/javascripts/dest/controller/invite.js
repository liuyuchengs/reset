define(function(){return function($scope,$rootScope,$location,Tool,Ajax,Weixin){$scope.bgStyle={width:window.screen.width,height:window.screen.width/320*145},$scope.bodyStyle={width:window.screen.width,"min-height":window.screen.height-50},$scope.shareObj={title:"悠康医生邀请好友即送现金啦",desc:"悠康医生邀请好友即可获得现金和代金券，快来看看吧!",link:"https://www.uokang.com/v2/htmls/index.html#/invite/register",imgUrl:"https://www.uokang.com/new/contents/img/logo.png",success:function(){$scope.showTip=!1,Tool.alert("分享成功!")},cancel:function(){},ready:!1},$scope.code="",$scope.showTip=!1,$scope.inviteInit=function(){if(Tool.noWindowListen(),$location.search().at){var accessToken=$location.search().at;$scope.queryCode(accessToken)}else Tool.checkLogin()?(Tool.loadUserinfo(),$scope.queryCode(Tool.userInfo.accessToken),Weixin.wxInit($scope),Weixin.wxConfig($scope)):Tool.alert("请先登录",function(){$rootScope.hasTip=!1,Tool.changeRoute("/user")})},$scope.queryCode=function(accessToken){Ajax.post({url:Tool.host+"/wx/user/createReferralCode",params:{accessToken:accessToken}}).then(function(data){0==data.code?($scope.code=data.data.referralCode,$scope.shareObj.link=$scope.shareObj.link+"?code="+$scope.code+"&name="+Tool.userInfo.nickname,$scope.shareObj.ready=!0):Tool.alert("查询邀请码错误!")})["catch"](function(){Tool.alert("查询邀请码失败!")})["finally"](function(){$rootScope.loading=!1})},$scope.queryShare=function(){Ajax.post({url:Tool.host+"/wx/share/queryById",params:{id:98}}).then(function(data){0==data.code?($scope.shareObj.title=data.data.title,$scope.shareObj.desc=data.data.content,$scope.shareObj.link=data.data.url+"?code="+$scope.code+"&name="+Tool.userInfo.nickname,$scope.shareObj.imgUrl=data.data.image,$scope.shareObj.ready=!0):(Tool.alert("获取分享内容失败，请稍后再试！"),$scope.shareObj.ready=!1)})["catch"](function(){Tool.alert("获取分享内容失败，请稍后再试！")})["finally"](function(){$rootScope.loading=!1})},$scope.switchTip=function(item){"close"===item&&($scope.showTip=!1),"open"===item&&($scope.showTip=!0)},$scope.share=function(){$scope.shareObj.ready?($scope.switchTip("open"),Weixin.wxShare($scope.shareObj)):Tool.alert("获取分享内容失败，请稍后再试！")},$scope.registerInit=function(){$location.search().code?($scope.code=$location.search().code,$scope.name=$location.search().name):Tool.alert("请检查链接是否完整",function(){$rootScope.hasTip=!1,Tool.changeRoute("/home")})},$scope.goRegister=function(){Tool.changeRoute("/register","code="+$scope.code)},angular.element(document).ready(function(){if($location.path()){var path=$location.path();"/invite/new"===path?$scope.inviteInit():"/invite/register"===path&&$scope.registerInit()}else Tool.changeRoute("/home")})}});