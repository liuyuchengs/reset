define(["require","exports"],function(require,exports){"use strict";function examDetail($scope,$rootScope,$location,ToolService,AjaxService){$scope.productId=null,$scope.hospitalId=null,$scope.product=null,$scope.productItem=[],$scope.schedules=[],$scope.hospital=null,$scope.hospitalImg=null,$scope.noSchedule=!1,$scope.noSelectTime=!1,$scope.scheduleParams={},$scope.filterParams=[{has:!0,val:"套餐详情"},{has:!1,val:"医院详情"},{has:!1,val:"须知"}],$scope.order={hospitalId:"",doctorId:"",productId:"",scheduleId:"",doctorName:"",treatmentTime:"",hospitalName:"",hospitalAddress:"",preferPrice:"",productName:"",flag:1,dealMoney:"",payMoney:"",realMoney:"",giftMoney:"",code:null,discountid:null},$scope["switch"]=function(index,obj){ToolService.select(index,obj)},$scope.back=function(){window.history.back()};var loadParams=function(){$location.search().productId&&($scope.productId=$location.search().productId,$scope.order.productId=$scope.productId),$location.search().hospitalId&&($scope.hospitalId=$location.search().hospitalId,$scope.order.hospitalId=$scope.hospitalId)},loadSchedule=function(){AjaxService.post({url:ToolService.host+"/wx/schedule/querybyhospitalid",data:{hospitalId:$scope.hospitalId}}).then(function(data){data.length>0?(mergeSchedule(data),$scope.schedules=data):$scope.noSchedule=!0})},mergeSchedule=function(items){for(var index=0;index>items.length;index++){var item=items[index];0==index?($scope.scheduleParams[item.scheduleid]={has:!0,val:item.dateStr},$scope.order.treatmentTime=item.dateStr,$scope.order.scheduleId=item.scheduleid):$scope.scheduleParams[item.scheduleid]={has:!1,val:item.dateStr}}},loadProduct=function(){AjaxService.post({url:ToolService.host+"/wx/product/packagedetal",data:{packageid:$scope.productId}}).then(function(data){0==data.code?(mergeProduct(data.data),$scope.product=data.data,$scope.order.productName=$scope.product.title,$scope.order.preferPrice=$scope.product.preferPrice+$scope.product.preferPriceType):ToolService.alert("加载套餐信息失败，请稍后再试!")})},mergeProduct=function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype,""!=item.smallImg&&null!=item.smallImg||(item.smallImg="../contents/img/p_default.png")},loadProductItem=function(){AjaxService.post({url:ToolService.host+"/wx/product/packagedetalItem",data:{packageid:$scope.productId}}).then(function(data){$scope.productItem=data})},loadHospital=function(){AjaxService.post({url:ToolService.host+"/wx/product/hospitalbyid",data:{id:$scope.hospitalId}}).then(function(data){0==data.code&&($scope.hospital=data.data,$scope.order.hospitalAddress=$scope.hospital.address,$scope.order.hospitalName=$scope.hospital.name)})},loadHopitalImg=function(){AjaxService.post({url:ToolService.host+"/wx/image/querybymainid",data:{type:"HOSPITAL",mainId:$scope.hospitalId}}).then(function(data){""!=data[0].url&&null!=data[0].url||(data[0].url="../contents/img/p_default.png"),$scope.hospitalImg=data[0].url})};$scope.selectTimeBtn=function(){$scope.noSchedule||($scope.hasSelectTime=!0)},$scope.cancelTime=function(){$scope.hasSelectTime=!1},$scope.selectTime=function(id){$scope.noSchedule||(ToolService.select(id,$scope.scheduleParams),$scope.order.treatmentTime=$scope.scheduleParams[id].val,$scope.order.scheduleId=id)},$scope.detail=function(){ToolService.checkLogin()?ToolService.infoComplete()?(ToolService.loadUser(),AjaxService.post({url:ToolService.host+"/wx/order/checkCodeMoney",data:{productId:$scope.order.productId},headers:{accessToken:ToolService.user.accessToken}}).then(function(data){$scope.order.dealMoney=data.dealMoney,$scope.order.payMoney=data.payMoney,$scope.order.realMoney=data.realMoney,$scope.order.giftMoney=data.giftMoney,parseFloat($scope.order.giftMoney)<=0&&($scope.order.flag=null),ToolService.setSession("makeorder",$scope.order),ToolService.changeRoute("/makeorder")})):ToolService.comfirm("请完善个人信息!",function(){$rootScope.followTip.has=!1,ToolService.changeRoute("/user/userinfo")}):ToolService.comfirm("请先登录并完善个人信息!",function(){$rootScope.followTip.has=!1,ToolService.changeRoute("/login")})},ToolService.reset(),loadParams(),loadProduct(),loadHospital(),loadHopitalImg(),loadProductItem(),loadSchedule()}return examDetail});