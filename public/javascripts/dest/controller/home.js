define(function(){return function($scope,$rootScope,$http,Tool,Ajax,Weixin){$scope.items=[],$scope.currentPage=1,$scope.noProduct=!1,$scope.noProductText="",$scope.banners=[],$scope.locationInfo="深圳市",$scope.imgStyle={width:screen.width},$scope.gotoMenu=function(path){Tool.goPage(path)},$scope.init=function(){$rootScope.hasBgColor=!1,$scope.loadRecommend(),$scope.queryBanner(),$scope.initSwiper(),Tool.getSession("locationInfo")?$scope.locationInfo=Tool.getSession("locationInfo").city:(Weixin.wxInit($scope,$scope.getLocation),Weixin.wxConfig($scope))},$scope.getLocation=function(latitude,longitude){var url="https://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&callback=JSON_CALLBACK&location="+latitude+","+longitude+"&key="+$scope.key;$http.jsonp(url).success(function(data){if(0==data.status){$scope.locationInfo=data.result.address_component.city;var locationInfo=Tool.getSession("locationInfo");locationInfo.city=data.result.address_component.city,Tool.setSession("locationInfo",locationInfo)}else $scope.locationInfo="定位失败"}).error(function(){$scope.locationInfo="定位失败"})},window.onscroll=function(){if(!$scope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.loadRecommend=function(){$rootScope.loading=!0;var url=Tool.host+"/wx/product/queryrecommend",params="city=深圳&currentPage="+$scope.currentPage;$http.post(url,params,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).success(function(data){0==data.code&&(data.data.length<1?($scope.items.length<1?$scope.noProductText="暂时没有热门项目":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeProdcut(data.data),$scope.items=$scope.items.concat(data.data))),$rootScope.loading=!1}).error(function(){$rootScope.loading=!1,Tool.alert("获取热门推荐数据失败，请稍后再试!"),$scope.noProduct=!0})},$scope.mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype,""!=item.samllimg&&null!=item.samllimg||(item.samllimg="../contents/img/p_default.png")})},$scope.queryBanner=function(){$rootScope.loading=!0;var url=Tool.host+"/wx/banner/query",params="type=home_banner";$http.post(url,params,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).success(function(data){0==data.code&&($scope.mergeBanner(data.data),$scope.banners=data.data),$rootScope.loading=!1}).error(function(){$rootScope.loading=!1,Tool.alert("获取主页图片失败，请稍后再试!")})},$scope.initSwiper=function(){new Swiper(".swiper-container",{loop:!1,pagination:".swiper-pagination",autoplay:2e3,autoplayDisableOnInteraction:!1,observeParents:!0,observer:!0,onSlideChangeEnd:function(swiper){0==swiper.activeIndex||1==swiper.activeIndex?(swiper.stopAutoplay(),setTimeout(function(){0!=swiper.activeIndex&&1!=swiper.activeIndex||swiper.startAutoplay()},4e3)):swiper.startAutoplay()}})},$scope.detail=function(productId,hospitalId,type){5===type?Tool.changeRoute("/exam/detail","productId="+productId+"&hospitalId="+hospitalId):Tool.changeRoute("/product/detail","flag=1&productId="+productId+"&hospitalId="+hospitalId)},$scope.activity=function(id){1===id&&Tool.changeRoute("/invite/new"),2===id&&Tool.changeRoute("/activity")},$scope.loadNext=function(){$scope.currentPage++,$scope.loadRecommend()}}});