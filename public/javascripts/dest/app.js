define(["angular","wx"],function(angular,wx){function loadController(obj,$controllerProvider){return function($q){var deferred=$q.defer();return require([obj.url],function(controller){controller.$inject=obj.inject,$controllerProvider.register(obj.name,controller),deferred.resolve()}),deferred.promise}}var app=angular.module("myApp",["ngRoute"]);return app.run(["$rootScope","$location",function($rootScope,$location){$rootScope.navMenuParams={home:!1,doctor:!1,interaction:!1,user:!1},$rootScope.hasNav=!1,$rootScope.loading=!1,$rootScope.message=null,$rootScope.hasCancel=null,$rootScope.hasComfirm=null,$rootScope.hasTip=null,$rootScope.comfirm=null,$rootScope.cancel=null,$rootScope.hasBgColor=!1,$rootScope.switchNavMenu=function(item){for(var index in $rootScope.navMenuParams)index===item?$rootScope.navMenuParams[item]=!0:$rootScope.navMenuParams[index]=!1},$rootScope.menuClick=function(item){$location.path(item)},$rootScope.$on("$routeChangeStart",function(){$rootScope.loading=!0,"/home"===$location.path()?($rootScope.switchNavMenu("home"),$rootScope.hasNav=!0):"/doctor"===$location.path()?($rootScope.switchNavMenu("doctor"),$rootScope.hasNav=!0):"/interaction"===$location.path()?($rootScope.switchNavMenu("interaction"),$rootScope.hasNav=!0):"/user"===$location.path()?($rootScope.switchNavMenu("user"),$rootScope.hasNav=!0):$rootScope.hasNav=!1}),$rootScope.$on("$routeChangeSuccess",function(){$rootScope.loading=!1}),$rootScope.changeRoute=function(path,query){$location.path(path),query?$location.search(query):$location.search("")}}]),app.config(["$routeProvider","$controllerProvider",function($routeProvider,$controllerProvider){$routeProvider.when("/home",{templateUrl:"home.html",controller:"homeCtrl"}).when("/doctor",{templateUrl:"doctor.html",controller:"doctorCtrl"}).when("/doctor/askDoctor",{templateUrl:"askdoctor.html",controller:"askDoctorCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/askDoctor.js",name:"askDoctorCtrl",inject:["$scope","$rootScope","$location","$http","Tool","Ajax"]},$controllerProvider)}}).when("/doctor/detail",{templateUrl:"doctordetail.html",controller:"doctorDetailCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/doctorDetail.js",name:"doctorDetailCtrl",inject:["$scope","$rootScope","$location","$anchorScroll","Ajax","Tool"]},$controllerProvider)}}).when("/interaction",{templateUrl:"interaction.html",controller:"interactionCtrl"}).when("/interaction/detail",{templateUrl:"interactiondetail.html",controller:"interactionDetailCtrl",resolve:{interaction:loadController({url:"../javascripts/dest/controller/interactionDetail.js",name:"interactionDetailCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/user",{templateUrl:"user.html",controller:"userCtrl"}).when("/user/userinfo",{templateUrl:"userinfo.html",controller:"userInfoCtrl",resolve:{userinfo:loadController({url:"../javascripts/dest/controller/userinfo.js",name:"userInfoCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/user/cush",{templateUrl:"cush.html",controller:"cushCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/cush.js",name:"cushCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/user/cush/read",{templateUrl:"cushreadme.html",controller:"cushCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/cush.js",name:"cushCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/user/cushover",{templateUrl:"cushover.html",controller:"cushOverCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/cushOver.js",name:"cushOverCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/user/userinfochange",{templateUrl:"userinfochange.html",controller:"userInfoChangeCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/userInfoChange.js",name:"userInfoChangeCtrl",inject:["$scope","$rootScope","$location","$timeout","$http","Ajax","Tool"]},$controllerProvider)}}).when("/user/order",{templateUrl:"order.html",controller:"userOrderCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/order.js",name:"userOrderCtrl",inject:["$scope","$rootScope","$location","Ajax","Tool"]},$controllerProvider)}}).when("/activity",{templateUrl:"activity.html",controller:"activityCtrl",resolve:{activity:loadController({url:"../javascripts/dest/controller/activity.js",name:"activityCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/product/detail",{templateUrl:"productdetail.html",controller:"productDetailCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/productDetail.js",name:"productDetailCtrl",inject:["$scope","$rootScope","$location","$http","Tool","Ajax"]},$controllerProvider)}}).when("/product",{templateUrl:"product.html",controller:"productCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/product.js",name:"productCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/exam/detail",{templateUrl:"examdetail.html",controller:"examDetailCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/examDetail.js",name:"examDetailCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/discount",{templateUrl:"discount.html",controller:"discountCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/discount.js",name:"discountCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/findpwd/phone",{templateUrl:"findpwdphone.html",controller:"findPassCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/findPass.js",name:"findPassCtrl",inject:["$scope","$rootScope","$location","$interval","Tool","Ajax"]},$controllerProvider)}}).when("/findpwd/code",{templateUrl:"findpwdcode.html",controller:"findPassCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/findPass.js",name:"findPassCtrl",inject:["$scope","$rootScope","$location","$interval","Tool","Ajax"]},$controllerProvider)}}).when("/findpwd/pwd",{templateUrl:"findpwdpwd.html",controller:"findPassCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/findPass.js",name:"findPassCtrl",inject:["$scope","$rootScope","$location","$interval","Tool","Ajax"]},$controllerProvider)}}).when("/grab",{templateUrl:"grab.html",controller:"grabCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/grab.js",name:"grabCtrl",inject:["$scope","$rootScope","$window","$location","Tool","Ajax","Weixin"]},$controllerProvider)}}).when("/grab/code",{templateUrl:"grabcode.html",controller:"grabCodeCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/grabCode.js",name:"grabCodeCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/grab/order",{templateUrl:"graborder.html",controller:"grabOrderCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/grabOrder.js",name:"grabOrderCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/login",{templateUrl:"login.html",controller:"loginCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/login.js",name:"loginCtrl",inject:["$scope","$rootScope","$location","Ajax","Tool"]},$controllerProvider)}}).when("/makeorder",{templateUrl:"makeorder.html",controller:"makeOrderCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/makeorder.js",name:"makeOrderCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/news",{templateUrl:"news.html",controller:"newsCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/news.js",name:"newsCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/news/detail",{templateUrl:"newsdetail.html",controller:"newsCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/news.js",name:"newsCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/order",{templateUrl:"order.html",controller:"orderCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/order.js",name:"orderCtrl",inject:["$scope","$rootScope","$location","Ajax","Tool"]},$controllerProvider)}}).when("/pay",{templateUrl:"pay.html",controller:"payCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/pay.js",name:"payCtrl",inject:["$scope","$rootScope","$location","Tool","Weixin"]},$controllerProvider)}}).when("/pay/result",{templateUrl:"payresult.html",controller:"payResultCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/payResult.js",name:"payResultCtrl",inject:["$scope","$rootScope","$location","Tool"]},$controllerProvider)}}).when("/register",{templateUrl:"register.html",controller:"registerCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/register.js",name:"registerCtrl",inject:["$scope","$rootScope","$location","$interval","Tool","Ajax"]},$controllerProvider)}}).when("/agreement",{templateUrl:"agreement.html"}).when("/write",{templateUrl:"write.html",controller:"writeCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/write.js",name:"writeCtrl",inject:["$scope","$rootScope","$http","Tool","Ajax"]},$controllerProvider)}}).when("/write/say",{templateUrl:"writesay.html",controller:"writeCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/write.js",name:"writeCtrl",inject:["$scope","$rootScope","$http","Tool","Ajax"]},$controllerProvider)}}).when("/write/note",{templateUrl:"writenote.html",controller:"writeCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/write.js",name:"writeCtrl",inject:["$scope","$rootScope","$http","Tool","Ajax"]},$controllerProvider)}}).when("/user/mypost",{templateUrl:"mypost.html",controller:"myPostCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/myPost.js",name:"myPostCtrl",inject:["$scope","$rootScope","$location","Ajax","Tool"]},$controllerProvider)}}).when("/user/mymessage",{templateUrl:"mymessage.html",controller:"myMessageCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/myMessage.js",name:"myMessageCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/user/myfollow",{templateUrl:"myfollow.html",controller:"myFollowCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/myFollow.js",name:"myFollowCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/exam",{templateUrl:"exam.html",controller:"examCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/exam.js",name:"examCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax"]},$controllerProvider)}}).when("/invite/new",{templateUrl:"invitenew.html",controller:"inviteCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/invite.js",name:"inviteCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax","Weixin"]},$controllerProvider)}}).when("/invite/register",{templateUrl:"inviteregister.html",controller:"inviteCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/invite.js",name:"inviteCtrl",inject:["$scope","$rootScope","$location","Tool","Ajax","Weixin"]},$controllerProvider)}}).when("/invite/notes",{templateUrl:"invitenotes.html",controller:"inviteNotesCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/inviteNotes.js",name:"inviteNotesCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).when("/user/paymoney",{templateUrl:"paymoney.html",controller:"payMoneyCtrl",resolve:{askDoctor:loadController({url:"../javascripts/dest/controller/payMoney.js",name:"payMoneyCtrl",inject:["$scope","$rootScope","Tool","Ajax"]},$controllerProvider)}}).otherwise({redirectTo:"/home"})}]),app.directive("fallbackSrc",function(){var fallbackSrc={link:function(scope,iElement,iAttrs){iElement.bind("error",function(){angular.element(this).attr("src",iAttrs.fallbackSrc)})}};return fallbackSrc}),app.directive("productError",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){iElement.bind("error",function(){angular.element(this).attr("src","../contents/img/p_default.png")})}}}),app.directive("doctorError",function(){return{restrict:"A",link:function(scope,iElement,iAttrs){iElement.bind("error",function(){angular.element(this).attr("src","../contents/img/doc-head.png")})}}}),app.directive("userError",function(){return{restrict:"A",link:function($scope,iElement,iAttrs){iElement.bind("error",function(){var imgUrl="../contents/img/men-head.png";iAttrs.userError&&"女"===iAttrs.userError&&(imgUrl="../contents/img/women-head.png"),angular.element(this).attr("src",imgUrl)})}}}),app.directive("zoomImage",function(){return{restrict:"A",link:function($scope,iElement,iAttrs){var containSize=iElement.css("width").slice(0,-2);iElement.css("height",containSize);var children=iElement.children();children.bind("load",function(){var width=children.css("width").slice(0,-2),height=children.css("height").slice(0,-2);if(width>height){var zWidth=containSize/height*width,zHeight=containSize;children.css("marginLeft",-(zWidth-containSize)/2)}else{var zHeight=containSize/width*height,zWidth=containSize;children.css("marginTop",-(zHeight-containSize)/2)}children.css("width",zWidth),children.css("height",zHeight)})}}}),app.filter("defaultHeadImg",function(){return function(input,sex){return null!==input&&""!==input||(input="男"===sex||null===sex||""===sex||void 0===sex?"../contents/img/men-head.png":"../contents/img/women-head.png"),input}}),app.filter("defaultImg",function(){return function(input,type){return null!=input&&""!=input||("doc"===type&&(input="../contents/img/doc-head.png"),"pro"===type&&(input="../contents/img/p_default.png")),input}}),app.service("Ajax",["$rootScope","$http","$q","Tool",function($rootScope,$http,$q,Tool){this.get=function(obj){if(obj.url){$rootScope.loading=!0;var defered=$q.defer();return $http.get(obj.url,{headers:obj.headers}).success(function(data){return defered.resolve(data)}).error(function(data){return defered.reject(data)}),defered.promise}},this.post=function(obj){if(obj.url){var defered=$q.defer();return obj.headers?obj.headers["Content-type"]||(obj.headers["Content-type"]="application/x-www-form-urlencoded;charset=UTF-8"):obj.headers={"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"},$rootScope.loading=!0,obj.params=Tool.convertParams(obj.params),$http.post(obj.url,obj.params,{headers:obj.headers}).success(function(data){defered.resolve(data)}).error(function(data){defered.reject(data)}),defered.promise}}}]),app.service("Tool",["$rootScope","$location",function($rootScope,$location){this.host="http://192.168.0.104:3000",this.userInfo={},this.getLocal=function(key){return JSON.parse(localStorage.getItem(key))},this.setLocal=function(key,value){localStorage.setItem(key,JSON.stringify(value))},this.removeLocal=function(key){localStorage.removeItem(key)},this.clearLocal=function(){localStorage.clear()},this.getSession=function(key){return JSON.parse(sessionStorage.getItem(key))},this.setSession=function(key,value){sessionStorage.setItem(key,JSON.stringify(value))},this.removeSession=function(key){sessionStorage.removeItem(key)},this.goUrl=function(url){url.length>0&&(location.href=url)},this.changeRoute=function(path,search){$location.path(path),search?$location.search(search):$location.search("")},this.checkLogin=function(){return!!this.getLocal("user")},this.isUserInfoComplete=function(){var userInfo=this.getLocal("user");return""!=userInfo.realname&&null!=userInfo.realname&&""!=userInfo.sex&&null!=userInfo.sex&&""!=userInfo.age&&null!=userInfo.age&&""!=userInfo.phone&&null!=userInfo.phone},this.select=function(params,obj){for(var proto in obj)proto==params?obj[params].has||(obj[params].has=!0):obj[proto].has&&(obj[proto].has=!1)},this.alert=function(mess,callback){$rootScope.message=mess,$rootScope.hasCancel=!1,$rootScope.hasComfirm=!0,$rootScope.hasTip=!0,callback?$rootScope.comfirm=callback:$rootScope.comfirm=function(){$rootScope.hasTip=!1}},this.comfirm=function(mess,callback){$rootScope.message=mess,$rootScope.hasCancel=!0,$rootScope.hasComfirm=!0,$rootScope.hasTip=!0,$rootScope.cancel=function(){$rootScope.hasTip=!1},$rootScope.comfirm=callback},this.loadUserinfo=function(){this.userInfo=this.getLocal("user")},this.convertParams=function(obj){var params="";for(var property in obj)null!=obj[property]&&(params+=property+"="+obj[property]+"&");return params=params.slice(0,params.length-1)},this.noWindowListen=function(){window.onscroll=null},this.getQueryString=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(reg);return null!=r?unescape(r[2]):null}}]),app.service("Weixin",["$rootScope","Ajax","Tool",function($rootScope,Ajax,Tool){this.wxInit=function($scope,callback){wx.ready(function(){wx.checkJsApi({jsApiList:["getLocation","chooseWXPay","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo"],success:function(result){result.checkResult.getLocation&&result.checkResult.chooseWXPay||Tool.alert("客户端版本过低，请微信升级客户端!")}}),callback&&wx.getLocation({type:"wgs84",success:function(res){var locationInfo={latitude:res.latitude,longitude:res.longitude};Tool.setSession("locationInfo",locationInfo),callback(locationInfo.latitude,locationInfo.longitude)},fail:function(){$scope.locationInfo="定位失败"}})})},this.wxConfig=function(scope){var params={debug:!1,appId:"",timestamp:"",nonceStr:"",signature:"",jsApiList:["getLocation","chooseWXPay","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo"]};Ajax.post({url:Tool.host+"/weixin/check/getjsconfig",params:{url:encodeURIComponent(location.href)}}).then(function(data){params.appId=data.appId,params.timestamp=data.timestamp,params.nonceStr=data.nonceStr,params.signature=data.signature,wx.config(params)})["catch"](function(){Tool.alert("初始化WX对象失败，请稍后再试！")})["finally"](function(){$rootScope.loading=!1})},this.wxShare=function(obj){wx.onMenuShareTimeline({title:obj.title,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareAppMessage({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,type:obj.type,dataUrl:obj.dataUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareQQ({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareQZone({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareWeibo({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel})},this.wxCheckPayParams=function(params){return""!=params.timestamp&&null!=params.timestamp&&""!=params.nonceStr&&null!=params.nonceStr&&""!=params["package"]&&null!=params["package"]&&""!=params.signType&&null!=params.signType&&""!=params.paySign&&null!=params.paySign},this.wxPay=function(orderId,code){var params={timestamp:"",nonceStr:"","package":"",signType:"",paySign:"",success:function(){window.location.href="https://www.uokang.com/v2/htmls/index.html#/pay/result?payResult=success"},cancel:function(){window.location.href="https://www.uokang.com/v2/htmls/index.html#/pay/result?payResult=fail"},fail:function(){window.location.href="https://www.uokang.com/v2/htmls/index.html#/pay/result?payResult=fail"}};if(""!=orderId&null!=orderId){var url=Tool.host+"/wx/order/weixin",params={payType:"JSAPI",orderId:orderId,code:code};Ajax.post({url:url,params:params,headers:{accessToken:Tool.getLocal("user").accessToken}}).then(function(data){params.timestamp=data.data.timeStamp,params.nonceStr=data.data.nonceStr,params["package"]=data.data["package"],params.signType="MD5",params.paySign=data.data.sign,""==params.timestamp||null==params.timestamp||""==params.nonceStr||null==params.nonceStr||""==params["package"]||null==params["package"]||""==params.signType||null==params.signType||""==params.paySign||null==params.paySign?Tool.alert("请求支付参数失败，请稍后再试!"):wx.chooseWXPay(params)})["catch"](function(){Tool.alert("请求支付参数失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})}}}]),app.service("Params",function(){this.defaultParams={"default":{has:!0,id:""}},this.areaParams={"default":{has:!0,val:""},futian:{has:!1,val:"福田区"},nanshan:{has:!1,val:"南山区"},luohu:{has:!1,val:"罗湖区"},baoan:{has:!1,val:"宝安区"},longhua:{has:!1,val:"龙华新区"},longgang:{has:!1,val:"龙岗区"},yantian:{has:!1,val:"盐田区"}},this.yakeParams={all:{has:!0,id:""},zzy:{has:!1,id:19},xiya:{has:!1,id:20},kcy:{has:!1,id:82},buya:{has:!1,id:22},baya:{has:!1,id:23},ycmr:{has:!1,id:24},jiaozheng:{has:!1,id:64},yichi:{has:!1,id:65},yzzl:{has:!1,id:63},qita:{has:!1,id:60}},this.meirongParams={all:{has:!0,id:""},yanbu:{has:!1,id:7},mianbu:{has:!1,id:8},bibu:{has:!1,id:9},xiong:{has:!1,id:45},xizhi:{has:!1,id:12},simi:{has:!1,id:78},zhushe:{has:!1,id:79},jiguang:{has:!1,id:80},koucun:{has:!1,id:81},qita:{has:!1,id:13}},this.fckParams={all:{has:!0,id:""},jiancha:{has:!1,id:48},fenmian:{has:!1,id:49}},this.zhongyiParams={all:{has:!0,id:""},toubu:{has:!1,id:51},jianjing:{has:!1,id:52},yaobu:{has:!1,id:53},tuibu:{has:!1,id:54},quanshen:{has:!1,id:55},jingluo:{has:!1,id:56},qita:{has:!1,id:57}},this.tijianParams={"default":{has:!0,val:""},shangye:{has:!1,val:75},changgui:{has:!1,val:67},zhongnian:{has:!1,val:69},laonian:{has:!1,val:70},ruzhi:{has:!1,val:71},yunqian:{has:!1,val:72},qingnian:{has:!1,val:68},ertong:{has:!1,val:74},manbing:{has:!1,val:73}},this.professionalParams={"default":{has:!0,val:this.defaultParams,proId:""},yake:{has:!1,val:this.yakeParams,proId:"2"},meirong:{has:!1,val:this.meirongParams,proId:"3"},fck:{has:!1,val:this.fckParams,proId:"4"},zhongyi:{has:!1,val:this.zhongyiParams,proId:"6"},tijian:{has:!1,val:this.tijianParams,proId:"5"}}}),app.controller("homeCtrl",["$scope","$rootScope","$http","Tool","Ajax","Weixin",function($scope,$rootScope,$http,Tool,Ajax,Weixin){$scope.items=[],$scope.currentPage=1,$scope.noProduct=!1,$scope.noProductText="",$scope.banners=[],$scope.locationInfo="深圳市",$scope.imgStyle={width:screen.width},$scope.gotoMenu=function(path){Tool.goPage(path)},$scope.init=function(){$rootScope.hasBgColor=!1,$scope.loadRecommend(),$scope.queryBanner(),$scope.initSwiper(),Tool.getSession("locationInfo")?$scope.locationInfo=Tool.getSession("locationInfo").city:(Weixin.wxInit($scope,$scope.getLocation),Weixin.wxConfig($scope))},$scope.getLocation=function(latitude,longitude){var url="https://apis.map.qq.com/ws/geocoder/v1/?output=jsonp&callback=JSON_CALLBACK&location="+latitude+","+longitude+"&key="+$scope.key;$http.jsonp(url).success(function(data){if(0==data.status){$scope.locationInfo=data.result.address_component.city;var locationInfo=Tool.getSession("locationInfo");locationInfo.city=data.result.address_component.city,Tool.setSession("locationInfo",locationInfo)}else $scope.locationInfo="定位失败"}).error(function(){$scope.locationInfo="定位失败"})},window.onscroll=function(){if(!$scope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.loadRecommend=function(){$rootScope.loading=!0;var url=Tool.host+"/wx/product/queryrecommend",params="city=深圳&currentPage="+$scope.currentPage;$http.post(url,params,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).success(function(data){0==data.code&&(data.data.length<1?($scope.items.length<1?$scope.noProductText="暂时没有热门项目":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeProdcut(data.data),$scope.items=$scope.items.concat(data.data))),$rootScope.loading=!1}).error(function(){Tool.alert("获取热门推荐数据失败，请稍后再试!"),$scope.noProduct=!0,$rootScope.loading=!1})},$scope.mergeProdcut=function(items){items.forEach(function(item){null!=item.priceunit&&""!=item.priceunit?item.preferPriceType=item.pricetype+"/"+item.priceunit:item.preferPriceType=item.pricetype,""!=item.samllimg&&null!=item.samllimg||(item.samllimg="../contents/img/p_default.png")})},$scope.queryBanner=function(){$rootScope.loading=!0;var url=Tool.host+"/wx/banner/query",params="type=home_banner";$http.post(url,params,{headers:{"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"}}).success(function(data){0==data.code&&($scope.banners=data.data),$rootScope.loading=!1}).error(function(){$rootScope.loading=!1,Tool.alert("获取主页图片失败，请稍后再试!")})},$scope.initSwiper=function(){new Swiper(".swiper-container",{loop:!1,pagination:".swiper-pagination",autoplay:2e3,autoplayDisableOnInteraction:!1,observeParents:!0,observer:!0,onSlideChangeEnd:function(swiper){0==swiper.activeIndex||1==swiper.activeIndex?(swiper.stopAutoplay(),setTimeout(function(){0!=swiper.activeIndex&&1!=swiper.activeIndex||swiper.startAutoplay()},4e3)):swiper.startAutoplay()}})},$scope.detail=function(productId,hospitalId,type){5===type?Tool.changeRoute("/exam/detail","productId="+productId+"&hospitalId="+hospitalId):Tool.changeRoute("/product/detail","flag=1&productId="+productId+"&hospitalId="+hospitalId)},$scope.activity=function(id){1===id&&Tool.changeRoute("/activity","flag=2"),2===id&&Tool.changeRoute("/invite/new"),3===id&&Tool.changeRoute("/activity","flag=1")},$scope.loadNext=function(){$scope.currentPage++,$scope.loadRecommend()}}]),app.controller("doctorCtrl",["$scope","$rootScope","$http","Tool","Ajax","Params",function($scope,$rootScope,$http,Tool,Ajax,Params){$scope.hasBg=!1,$scope.profValue="default",$scope.profItemValue="default",$scope.doctors=[],$scope.noProduct=!1,$scope.noProductText="",$scope.orderParams={"default":{has:!0,val:""},title:{has:!1,val:"profession_title desc"},score:{has:!1,val:"score desc"}},$scope.areaParams=Params.areaParams,$scope.professionalParams=Params.professionalParams,$scope.queryParams={professionId:"",itemid:"",orderby:"",city:"深圳",area:"",pageRows:10,currentPage:1},$scope.menuParams={area:{has:!1,val:$scope.areaParams},order:{has:!1,val:$scope.orderParams},professional:{has:!1,val:$scope.professionalParams}},$scope.init=function(){$rootScope.hasBgColor=!0,$scope.loadDoctor()},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.switchMenu=function(menu){$scope.switchObj(menu,$scope.menuParams,!0)},$scope.selectMenu=function(item,obj){var ob=$scope.menuParams[obj].val;$scope.switchObj(item,ob),"area"==obj&&($scope.queryParams.area=ob[item].val),"order"==obj&&($scope.queryParams.orderby=ob[item].val),$scope.switchMenu(obj),$scope.resetDate(),$scope.loadDoctor()},$scope.selectProfression=function(item){$scope.switchObj(item,$scope.professionalParams)},$scope.selectProfressionItem=function(item,pro){item!=$scope.profItemValue&&(""==$scope.profValue&&""==$scope.profItemValue?$scope.professionalParams[pro].val[item].has=!0:($scope.professionalParams[$scope.profValue].val[$scope.profItemValue].has=!1,$scope.professionalParams[pro].val[item].has=!0),$scope.profItemValue=item,$scope.profValue=pro,$scope.queryParams.professionId=$scope.professionalParams[pro].proId,$scope.queryParams.itemid=$scope.professionalParams[pro].val[item].id,$scope.switchMenu("professional"),$scope.resetDate(),$scope.loadDoctor())},$scope.switchObj=function(item,obj,hasBg){for(var pro in obj)pro==item?(obj[pro].has=!obj[pro].has,hasBg&&($scope.hasBg=obj[pro].has)):obj[pro].has=!1},$scope.loadDoctor=function(){Ajax.post({url:Tool.host+"/wx/doctor/querydoctorbycityandprofession",params:$scope.queryParams}).then(function(data){data.data.length<1?($scope.doctors.length<1?$scope.noProductText="没有项目信息,请选择其他区域或者时间!":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergeDoctor(data.data),$scope.doctors=$scope.doctors.concat(data.data))})["catch"](function(){$scope.noProduct=!0,Tool.alert("数据加载失败，请稍后再试!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergeDoctor=function(items){items.forEach(function(item){""!=item.score&&null!=item.score||(item.score="暂无评"),""!=item.sales&&null!=item.sales||(item.sales=0)})},$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.loadDoctor()},$scope.resetDate=function(){$scope.queryParams.currentPage=1,$scope.noProduct=!1,$scope.noProductText="",$scope.doctors=[]},$scope.detail=function(id){Tool.changeRoute("/doctor/detail","id="+id)}}]),app.controller("interactionCtrl",["$scope","$rootScope","$http","Tool","Ajax",function($scope,$rootScope,$http,Tool,Ajax){$scope.noProductText="",$scope.noProduct=!1,$scope.hasInteractionMenu=!0,$scope.queryParams={flag:1,pageRows:10,currentPage:1},$scope.navParams={kanya:{has:!0,val:1},shumei:{has:!1,val:2},yunsheng:{has:!1,val:3}},$scope.posts=[],$scope.init=function(){$rootScope.hasBgColor=!1,$scope.queryPost()},$scope.queryPost=function(){Ajax.post({url:Tool.host+"/wx/post/postList",params:$scope.queryParams}).then(function(data){data.data.length<1?($scope.posts.length<1?$scope.noProductText="还没有帖子信息":$scope.noProductText="已经没有项目了!",$scope.noProduct=!0):($scope.mergePost(data.data),$scope.posts=$scope.posts.concat(data.data))})["catch"](function(){Tool.alert("获取帖子信息失败!")})["finally"](function(){$rootScope.loading=!1})},$scope.mergePost=function(items){items.forEach(function(item){null!=item.visitNum&&""!=item.visitNum||(item.visitNum=0),""!=item.commentNum&&null!=item.commentNum||(item.commentNum=0),null!==item.faceImage|""!==item.faceImage&&(item.faceImage="https://biz.uokang.com/"+item.faceImage);for(var index in item.list2)""!=item.list2[index]&&null!=item.list2[index]||item.list2.splice(index,1)})},$scope.loadNext=function(){$scope.queryParams.currentPage++,$scope.queryPost()},window.onscroll=function(){if(!$rootScope.loading&&!$scope.noProduct){var body=document.body,html=document.documentElement,height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);height>window.innerHeight&&height-window.scrollY-window.innerHeight<100&&$scope.loadNext()}},$scope.switchNav=function(item){$scope.queryParams.flag=$scope.navParams[item].val,Tool.select(item,$scope.navParams),$scope.queryParams.currentPage=1,$scope.noProduct=!1,$scope.noProductText="",$scope.posts=[],$scope.queryPost()},$scope.detail=function(id){Tool.changeRoute("/interaction/detail","id="+id)}}]),app.controller("userCtrl",["$scope","$rootScope","$location","Tool","Ajax",function($scope,$rootScope,$location,Tool,Ajax){$scope.user={},$scope.isLogin=!1,$scope.init=function(){$rootScope.hasBgColor=!0,Tool.noWindowListen(),$scope.initText(),Tool.checkLogin()&&(Tool.loadUserinfo(),$scope.queryFocus())},$scope.initText=function(){Tool.checkLogin()?(Tool.loadUserinfo(),$scope.user=Tool.userInfo,$scope.isLogin=!0,""!==$scope.user.nickname&&null!==$scope.user.nickname||($scope.user.nickname="您还没有填写昵称")):($scope.user.face="../contents/img/men-head.png",$scope.user.tip="点击登录注册")},$scope.alert=function(mess){Tool.alert(mess)},$scope.queryFocus=function(){Ajax.post({url:Tool.host+"/wx/focus/focusManCount",params:{accessToken:Tool.userInfo.accessToken}}).then(function(data){0==data.code&&(null!==data.data.countFocusMan&&""!==data.data.countFocusMan||(data.data.countFocusMan=0),null!==data.data.countFansMan&&""!==data.data.countFansMan||(data.data.countFansMan=0),$scope.countFocusMan=data.data.countFocusMan,$scope.countFansMan=data.data.countFansMan);
})["catch"](function(){$scope.countFocusMan=0,$scope.countFansMan=0,Tool.alert("获取粉丝信息失败!")})["finally"](function(){$rootScope.loading=!1})},$scope["goto"]=function(path,query){Tool.checkLogin()?Tool.changeRoute(path,query):Tool.changeRoute("/login","")}}]),app});