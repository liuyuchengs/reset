define(["app","wx"],function(app,wx){app.service("Ajax",["$rootScope","$http","$q","Tool",function($rootScope,$http,$q,Tool){this.get=function(obj){if(obj.url){$rootScope.loading=!0;var defered=$q.defer();return $http.get(obj.url,{headers:obj.headers}).success(function(data){return defered.resolve(data)}).error(function(data){return defered.reject(data)}),defered.promise}},this.post=function(obj){if(obj.url){var defered=$q.defer();return obj.headers?obj.headers["Content-type"]||(obj.headers["Content-type"]="application/x-www-form-urlencoded;charset=UTF-8"):obj.headers={"Content-type":"application/x-www-form-urlencoded;charset=UTF-8"},$rootScope.loading=!0,obj.params=Tool.convertParams(obj.params),$http.post(obj.url,obj.params,{headers:obj.headers}).success(function(data){defered.resolve(data)}).error(function(data){defered.reject(data)}),defered.promise}}}]),app.service("Tool",["$rootScope","$location",function($rootScope,$location){this.host="http://192.168.0.104:3000",this.userInfo={},this.getLocal=function(key){return JSON.parse(localStorage.getItem(key))},this.setLocal=function(key,value){localStorage.setItem(key,JSON.stringify(value))},this.removeLocal=function(key){localStorage.removeItem(key)},this.clearLocal=function(){localStorage.clear()},this.getSession=function(key){return JSON.parse(sessionStorage.getItem(key))},this.setSession=function(key,value){sessionStorage.setItem(key,JSON.stringify(value))},this.removeSession=function(key){sessionStorage.removeItem(key)},this.goUrl=function(url){url.length>0&&(location.href=url)},this.changeRoute=function(path,search){$location.path(path),search?$location.search(search):$location.search("")},this.checkLogin=function(){return!!this.getLocal("user")},this.isUserInfoComplete=function(){var userInfo=this.getLocal("user");return""!=userInfo.realname&&null!=userInfo.realname&&""!=userInfo.sex&&null!=userInfo.sex&&""!=userInfo.age&&null!=userInfo.age&&""!=userInfo.phone&&null!=userInfo.phone},this.select=function(params,obj){for(var proto in obj)proto==params?obj[params].has||(obj[params].has=!0):obj[proto].has&&(obj[proto].has=!1)},this.alert=function(mess,callback){$rootScope.message=mess,$rootScope.hasCancel=!1,$rootScope.hasComfirm=!0,$rootScope.hasTip=!0,callback?$rootScope.comfirm=callback:$rootScope.comfirm=function(){$rootScope.hasTip=!1}},this.comfirm=function(mess,callback){$rootScope.message=mess,$rootScope.hasCancel=!0,$rootScope.hasComfirm=!0,$rootScope.hasTip=!0,$rootScope.cancel=function(){$rootScope.hasTip=!1},$rootScope.comfirm=callback},this.loadUserinfo=function(){this.userInfo=this.getLocal("user")},this.convertParams=function(obj){var params="";for(var property in obj)null!=obj[property]&&(params+=property+"="+obj[property]+"&");return params=params.slice(0,params.length-1)},this.noWindowListen=function(){window.onscroll=null}}]),app.service("Weixin",["$rootScope","Ajax","Tool",function($rootScope,Ajax,Tool){this.wxInit=function($scope,callback){wx.ready(function(){wx.checkJsApi({jsApiList:["getLocation","chooseWXPay","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo"],success:function(result){result.checkResult.getLocation&&result.checkResult.chooseWXPay||Tool.alert("客户端版本过低，请微信升级客户端!")}}),callback&&wx.getLocation({type:"wgs84",success:function(res){var locationInfo={latitude:res.latitude,longitude:res.longitude};Tool.setSession("locationInfo",locationInfo),callback(locationInfo.latitude,locationInfo.longitude)},fail:function(){$scope.locationInfo="定位失败"}})})},this.wxConfig=function(scope){var params={debug:!1,appId:"",timestamp:"",nonceStr:"",signature:"",jsApiList:["getLocation","chooseWXPay","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareQZone","onMenuShareWeibo"]};Ajax.post({url:Tool.host+"/weixin/check/getjsconfig",params:"url="+encodeURIComponent(location.href)}).then(function(data){params.appId=data.appId,params.timestamp=data.timestamp,params.nonceStr=data.nonceStr,params.signature=data.signature,wx.config(params)})["catch"](function(){Tool.alert("初始化WX对象失败，请稍后再试！")})},this.wxShare=function(obj){wx.onMenuShareTimeline({title:obj.title,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareAppMessage({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,type:obj.type,dataUrl:obj.dataUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareQQ({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareQZone({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel}),wx.onMenuShareWeibo({title:obj.title,desc:obj.desc,link:obj.link,imgUrl:obj.imgUrl,success:obj.success,cancel:obj.cancel})},this.wxCheckPayParams=function(params){return""!=params.timestamp&&null!=params.timestamp&&""!=params.nonceStr&&null!=params.nonceStr&&""!=params["package"]&&null!=params["package"]&&""!=params.signType&&null!=params.signType&&""!=params.paySign&&null!=params.paySign},this.wxPay=function(orderId,code,scope){var params={timestamp:"",nonceStr:"","package":"",signType:"",paySign:"",success:function(){Tool.changeRoute("/pay/result","payResult=success")},cancel:function(){Tool.changeRoute("/pay/result","payResult=fail")},fail:function(){Tool.changeRoute("/pay/result","payResult=fail")}};if(""!=orderId&null!=orderId){var accessToken=Tool.getLocal("accessToken"),url=Tool.host+"/wx/order/weixin",params="payType=JSAPI&orderId="+orderId+"&code="+code;Ajax.post({url:url,params:params,headers:{accessToken:accessToken}}).then(function(data){params.timestamp=data.data.timeStamp,params.nonceStr=data.data.nonceStr,params["package"]=data.data["package"],params.signType="MD5",params.paySign=data.data.sign,""==params.timestamp||null==params.timestamp||""==params.nonceStr||null==params.nonceStr||""==params["package"]||null==params["package"]||""==params.signType||null==params.signType||""==params.paySign||null==params.paySign?(scope.loading=!1,Tool.alert(scope,"请求支付参数失败，请稍后再试!")):(scope.loading=!1,wx.chooseWXPay(params))})["catch"](function(){Tool.alert("请求支付参数失败，请稍后再试!")})}}}]),app.service("Params",[function(){this.defaultParams={"default":{has:!0,id:""}},this.areaParams={"default":{has:!0,val:""},futian:{has:!1,val:"福田区"},nanshan:{has:!1,val:"南山区"},luohu:{has:!1,val:"罗湖区"},baoan:{has:!1,val:"宝安区"},longhua:{has:!1,val:"龙华新区"},longgang:{has:!1,val:"龙岗区"},yantian:{has:!1,val:"盐田区"}},this.yakeParams={all:{has:!0,id:""},zzy:{has:!1,id:19},xiya:{has:!1,id:20},kcy:{has:!1,id:82},buya:{has:!1,id:22},baya:{has:!1,id:23},ycmr:{has:!1,id:24},jiaozheng:{has:!1,id:64},yichi:{has:!1,id:65},yzzl:{has:!1,id:63},qita:{has:!1,id:60}},this.meirongParams={all:{has:!0,id:""},yanbu:{has:!1,id:7},mianbu:{has:!1,id:8},bibu:{has:!1,id:9},xiong:{has:!1,id:45},xizhi:{has:!1,id:12},simi:{has:!1,id:78},zhushe:{has:!1,id:79},jiguang:{has:!1,id:80},koucun:{has:!1,id:81},qita:{has:!1,id:13}},this.fckParams={all:{has:!0,id:""},jiancha:{has:!1,id:48},fenmian:{has:!1,id:49}},this.zhongyiParams={all:{has:!0,id:""},toubu:{has:!1,id:51},jianjing:{has:!1,id:52},yaobu:{has:!1,id:53},tuibu:{has:!1,id:54},quanshen:{has:!1,id:55},jingluo:{has:!1,id:56},qita:{has:!1,id:57}},this.tijianParams={"default":{has:!0,val:""},shangye:{has:!1,val:75},changgui:{has:!1,val:67},zhongnian:{has:!1,val:69},laonian:{has:!1,val:70},ruzhi:{has:!1,val:71},yunqian:{has:!1,val:72},qingnian:{has:!1,val:68},ertong:{has:!1,val:74},manbing:{has:!1,val:73}},this.professionalParams={"default":{has:!0,val:this.defaultParams,proId:""},yake:{has:!1,val:this.yakeParams,proId:"2"},meirong:{has:!1,val:this.meirongParams,proId:"3"},fck:{has:!1,val:this.fckParams,proId:"4"},zhongyi:{has:!1,val:this.zhongyiParams,proId:"6"},tijian:{has:!1,val:this.tijianParams,proId:"5"}}}])});