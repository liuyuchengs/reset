{"version":3,"sources":["routes/proxyUserRoute.ts"],"names":[],"mappings":";;;;;;;;;AAAA,MAAO,EAAE,WAAW,IAAI,CAAC,CAAC;AAC1B,MAAO,OAAO,WAAW,SAAS,CAAC,CAAC;AACpC,MAAO,YAAY,WAAW,2BAA2B,CAAC,CAAC;AAC3D,MAAO,MAAM,WAAW,QAAQ,CAAC,CAAC;AAClC,MAAO,IAAI,WAAW,mBAAmB,CAAC,CAAC;AAE3C;;;GAGG;AACH,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC;AAChC,MAAM,GAAG,GAAG,wBAAwB,CAAC;AACrC,IAAI,MAAM,GAAG,MAAM,CAAC,EAAC,IAAI,EAAC,aAAa,EAAC,CAAC,CAAC;AAE1C;;;;;GAKG;AACH,mBAAyB,GAAmB,EAAC,GAAoB,EAAC,IAAyB;;QACvF,EAAE,CAAA,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA,CAAC;YACT,IAAI,OAAc,CAAC;YACnB,IAAI,MAAU,CAAC;YACf,SAAS;YACT,IAAG,CAAC;gBACA,OAAO,GAAI,GAAG,CAAC,IAAI,CAAC,IAAI,GAAC,GAAG,GAAC,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;gBAChE,MAAM,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,EAAC,OAAO,CAAC,CAAC;YACjD,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACR,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACjB,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACpB,CAAC;YACD,WAAW;YACX,IAAG,CAAC;gBACA,IAAI,QAAQ,GAAO,EAAE,CAAC;gBACtB,QAAQ,CAAC,SAAS,GAAG,EAAE,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC;gBAClD,QAAQ,CAAC,IAAI,GAAG,KAAK,CAAC;gBACtB,QAAQ,CAAC,GAAG,GAAG,KAAK,CAAC;gBACrB,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;gBACzB,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBAC7B,MAAM,GAAG,MAAM,YAAY,CAAC,OAAO,CAAC,GAAG,EAAC,GAAG,CAAC,CAAC;gBAC7C,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACrB,CAAC;YAAA,KAAK,CAAA,CAAC,GAAG,CAAC,CAAA,CAAC;gBACR,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACjB,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;YACpB,CAAC;QACL,CAAC;QAAA,IAAI,CAAA,CAAC;YACF,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;QACpB,CAAC;IACL,CAAC;CAAA;AACD,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,EAAC,SAAS,CAAC,CAAC;AAGjD,iBAAS,MAAM,CAAC","file":"routes/proxyUserRoute.js","sourcesContent":["import fs = require(\"fs\");\nimport express = require(\"express\");\nimport proxyRequest = require(\"./../modules/ProxyRequest\");\nimport multer = require(\"multer\");\nimport Tool = require(\"./../modules/Tool\");\n\n/**\n * 用户信息修改转发\n * @module\n */\nconst router = express.Router();\nconst url = \"https://www.uokang.com\";\nlet upload = multer({dest:\"temp/upload\"});\n\n/**\n * 修改用户信息\n * @param {blob} headImage - 头像\n * @param {string} name - 修改的字段,修改头像时可不填\n * @param {string} val - 修改的字段的值\n */\nasync function proxyUser(req:express.Request,res:express.Response,next:express.NextFunction){\n    if(req.file){\n        let newPath:string;\n        let result:any;\n        // 添加图片后缀\n        try{\n            newPath =  req.file.path+\".\"+req.file.originalname.split(\".\")[1]\n            await Tool.renameFile(req.file.path,newPath);\n        }catch(err){\n            console.log(err);\n            res.status(500);\n        }\n        // 发起http请求\n        try{\n            let formData:any = {};\n            formData.headImage = fs.createReadStream(newPath);\n            formData.name = \"img\";\n            formData.val = \"img\";\n            req.body.isMulter = true;\n            req.body.formData = formData;\n            result = await proxyRequest.request(req,url);\n            res.send(result);\n        }catch(err){\n            console.log(err);\n            res.status(500);\n        }     \n    }else{\n        res.status(400);\n    }\n}\nrouter.use(upload.single(\"headImage\"),proxyUser);\n\n\nexport = router;"],"sourceRoot":"../src"}